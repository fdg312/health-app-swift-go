# ============================================
# Health Hub API - Environment Configuration
# ============================================
# Copy this file to .env and fill in your values
# DO NOT commit .env to version control!

# --------------------------------------------
# Application Environment
# --------------------------------------------
# Options: local | staging | production
APP_ENV=local

# Server port
PORT=8080

# Log level (debug | info | warn | error)
LOG_LEVEL=debug


# --------------------------------------------
# Database Configuration
# --------------------------------------------
# PostgreSQL connection strings
# Priority: DATABASE_URL_POOLED > DATABASE_URL > DATABASE_URL_DIRECT

# Pooled connection (recommended for app runtime)
DATABASE_URL_POOLED=postgresql://user:password@localhost:5432/healthhub?sslmode=disable

# Standard connection (fallback)
DATABASE_URL=postgresql://user:password@localhost:5432/healthhub?sslmode=disable

# Direct connection (for migrations/DDL operations)
DATABASE_URL_DIRECT=postgresql://user:password@localhost:5432/healthhub?sslmode=disable

# Run migrations automatically on startup (0 or 1)
RUN_MIGRATIONS_ON_STARTUP=0


# --------------------------------------------
# CORS Configuration
# --------------------------------------------
# Comma-separated list of allowed origins
# Use * for all origins in development only
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080

# Allow credentials (0 or 1)
CORS_ALLOW_CREDENTIALS=1


# --------------------------------------------
# Rate Limiting
# --------------------------------------------
# Requests per second (0 = disabled)
RATE_LIMIT_RPS=10

# Burst size
RATE_LIMIT_BURST=20


# --------------------------------------------
# Authentication & Authorization
# --------------------------------------------
# Auth mode: none | dev | siwa
# - none: No authentication
# - dev: Development mode (email OTP + dev tokens)
# - siwa: Sign in with Apple
AUTH_MODE=dev

# Require authentication for all endpoints (0 or 1)
AUTH_REQUIRED=1

# Enable email OTP authentication (0 or 1)
# If not set, auto-enabled when AUTH_MODE != none
EMAIL_AUTH_ENABLED=1

# JWT configuration
JWT_SECRET=change_me_to_a_secure_random_string_at_least_32_chars
JWT_ISSUER=health-hub
JWT_TTL_MINUTES=10080

# OTP (One-Time Password) configuration
OTP_SECRET=another_secure_random_string_for_otp_hashing
OTP_TTL_SECONDS=600
OTP_MAX_ATTEMPTS=5
OTP_RESEND_MIN_SECONDS=60
OTP_MAX_SEND_PER_HOUR=5

# Debug: return OTP code in API response (dev only, 0 or 1)
OTP_DEBUG_RETURN_CODE=1


# --------------------------------------------
# Apple Sign-In (SIWA) Configuration
# --------------------------------------------
# Required when AUTH_MODE=siwa
APPLE_BUNDLE_ID=com.yourcompany.healthhub
APPLE_ISS=https://appleid.apple.com
APPLE_JWKS_URL=https://appleid.apple.com/auth/keys
APPLE_SUB_PREFIX=apple:


# --------------------------------------------
# Email / SMTP Configuration
# --------------------------------------------
# Email sender mode: local | smtp
# - local: Print OTP codes to console (dev only)
# - smtp: Send emails via SMTP server
EMAIL_SENDER_MODE=local

# SMTP settings (required when EMAIL_SENDER_MODE=smtp)
SMTP_HOST=smtp.yandex.ru
SMTP_PORT=587
SMTP_USERNAME=your-email@yandex.ru
SMTP_PASSWORD=your-app-specific-password
SMTP_FROM=HealthHub <no-reply@yourdomain.com>
SMTP_USE_TLS=1


# --------------------------------------------
# Blob Storage / S3 Configuration
# --------------------------------------------
# Blob mode: local | s3 | auto
# - local: Store files on local filesystem
# - s3: Store files in S3-compatible storage
# - auto: Use S3 if configured, otherwise local
BLOB_MODE=local

# Reports mode (optional override)
# If not set, inherits BLOB_MODE
REPORTS_MODE=local

# S3-compatible storage (Yandex Object Storage, AWS S3, MinIO, etc.)
S3_ENDPOINT=https://storage.yandexcloud.net
S3_REGION=ru-central1
S3_BUCKET=your-bucket-name
S3_ACCESS_KEY_ID=your-access-key-id
S3_SECRET_ACCESS_KEY=your-secret-access-key
S3_PUBLIC_BASE_URL=https://storage.yandexcloud.net/your-bucket-name

# S3 presigned URL TTL in seconds (default: 900 = 15 minutes)
S3_PRESIGN_TTL_SECONDS=900

# Prefer public URLs over presigned URLs (0 or 1)
S3_PREFER_PUBLIC_URL=0


# --------------------------------------------
# File Upload Configuration
# --------------------------------------------
# Maximum upload size in MB
UPLOAD_MAX_MB=10

# Allowed MIME types (comma-separated)
UPLOAD_ALLOWED_MIME=image/jpeg,image/png,image/heic

# Maximum sources per check-in
SOURCES_MAX_PER_CHECKIN=4


# --------------------------------------------
# Reports Configuration
# --------------------------------------------
# Maximum date range for reports in days
REPORTS_MAX_RANGE_DAYS=90

# Default report TTL in hours
REPORTS_DEFAULT_TTL_HOURS=168


# --------------------------------------------
# Notifications & Inbox
# --------------------------------------------
# Maximum notifications per day
NOTIFICATIONS_MAX_PER_DAY=4


# --------------------------------------------
# Health Metrics Defaults
# --------------------------------------------
# Default minimum sleep in minutes (7 hours = 420)
DEFAULT_SLEEP_MIN_MINUTES=420

# Default minimum steps per day
DEFAULT_STEPS_MIN=6000

# Default minimum active energy in kcal
DEFAULT_ACTIVE_ENERGY_MIN_KCAL=200


# --------------------------------------------
# Intakes Configuration
# --------------------------------------------
# Maximum water intake per day in ml
INTAKES_MAX_WATER_ML_PER_DAY=8000

# Default water add amount in ml
INTAKES_WATER_DEFAULT_ADD_ML=250

# Maximum supplements per profile
INTAKES_MAX_SUPPLEMENTS=100


# --------------------------------------------
# AI Configuration
# --------------------------------------------
# AI mode: mock | openai
# - mock: Use mock responses (no API calls)
# - openai: Use OpenAI API
AI_MODE=mock

# OpenAI configuration (required when AI_MODE=openai)
OPENAI_API_KEY=sk-your-openai-api-key
OPENAI_MODEL=gpt-4-turbo-preview

# AI parameters
AI_MAX_OUTPUT_TOKENS=600
AI_TEMPERATURE=0.3
AI_TIMEOUT_SECONDS=20


# ============================================
# Example Configurations
# ============================================

# --- Local Development ---
# APP_ENV=local
# AUTH_MODE=dev
# AUTH_REQUIRED=0
# EMAIL_SENDER_MODE=local
# BLOB_MODE=local
# AI_MODE=mock
# DATABASE_URL=postgresql://localhost:5432/healthhub

# --- Staging Environment ---
# APP_ENV=staging
# AUTH_MODE=siwa
# AUTH_REQUIRED=1
# EMAIL_SENDER_MODE=smtp
# BLOB_MODE=s3
# AI_MODE=openai
# DATABASE_URL_POOLED=postgresql://user:pass@db.example.com:5432/healthhub?sslmode=require

# --- Production Environment ---
# APP_ENV=production
# AUTH_MODE=siwa
# AUTH_REQUIRED=1
# EMAIL_SENDER_MODE=smtp
# BLOB_MODE=s3
# AI_MODE=openai
# JWT_SECRET=<strong-random-secret-min-32-chars>
# DATABASE_URL_POOLED=postgresql://user:pass@db.example.com:5432/healthhub?sslmode=require
# DATABASE_URL_DIRECT=postgresql://user:pass@db.example.com:5432/healthhub?sslmode=require
