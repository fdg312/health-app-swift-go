# Health Hub ‚Äî –¶–µ–Ω—Ç—Ä –∑–¥–æ—Ä–æ–≤—å—è

Monorepo –¥–ª—è MVP –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è "–¶–µ–Ω—Ç—Ä –∑–¥–æ—Ä–æ–≤—å—è": Go backend + iOS SwiftUI –∫–ª–∏–µ–Ω—Ç.

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: Sign in with Apple (SIWA), Email OTP, Dev —Ç–æ–∫–µ–Ω—ã
- ‚úÖ **–ü—Ä–æ—Ñ–∏–ª–∏**: Owner/Dependent —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –¥–æ—Å—Ç—É–ø–æ–º
- ‚úÖ **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è HealthKit**: Steps, Active Energy, Sleep, HR, Nutrition
- ‚úÖ **–ú–µ—Ç—Ä–∏–∫–∏**: Daily/Hourly –∞–≥—Ä–µ–≥–∞—Ç—ã —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ **–ß–µ–∫–∏–Ω—ã**: –£—Ç—Ä–µ–Ω–Ω–∏–µ/–≤–µ—á–µ—Ä–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —Å –æ—Ü–µ–Ω–∫–∞–º–∏ –∏ —Ç–µ–≥–∞–º–∏
- ‚úÖ **Feed/Day**: –ï–¥–∏–Ω–∞—è –ª–µ–Ω—Ç–∞ —Å–æ–±—ã—Ç–∏–π –¥–Ω—è
- ‚úÖ **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: Inbox —Å —É–º–Ω—ã–º–∏ –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è–º–∏
- ‚úÖ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏**: –ü–æ—Ä–æ–≥–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, quiet hours, —á–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞
- ‚úÖ **–ß–∞—Ç —Å AI**: Mock/OpenAI –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏ (proposals)
- ‚úÖ **Proposals**: settings_update, vitamins_schedule, workout_plan, nutrition_plan
- ‚úÖ **–ò—Å—Ç–æ—á–Ω–∏–∫–∏**: –§–æ—Ç–æ, —Å—Å—ã–ª–∫–∏, –∑–∞–º–µ—Ç–∫–∏ —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ —á–µ–∫–∏–Ω–∞–º
- ‚úÖ **–û—Ç—á—ë—Ç—ã**: PDF/CSV —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö —Å blob storage
- ‚úÖ **–î–æ–±–∞–≤–∫–∏**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏—Ç–∞–º–∏–Ω–∞–º–∏ –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è–º–∏ –ø—Ä–∏—ë–º–∞
- ‚úÖ **–ü–ª–∞–Ω—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫**: –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–æ–≤, –æ—Ç–º–µ—Ç–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å HealthKit
- ‚úÖ **–¶–µ–ª–∏ –ø–æ –ø–∏—Ç–∞–Ω–∏—é**: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–∞–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç–æ–≤ (–∫–∞–ª–æ—Ä–∏–∏, –ë–ñ–£, –∫–∞–ª—å—Ü–∏–π)
- ‚úÖ **–ü–ª–∞–Ω—ã –ø–∏—Ç–∞–Ω–∏—è**: –ù–µ–¥–µ–ª—å–Ω—ã–µ –º–µ–Ω—é —Å –æ–±—ã—á–Ω—ã–º–∏ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ Home, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ—Ç AI

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```
health-hub/
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ Makefile               # make test / run / smoke / migrate-up / build
‚îú‚îÄ‚îÄ render.yaml            # Render Blueprint (one-click deploy)
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ INDEX.md           # –ö–∞—Ä—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ —Å—Å—ã–ª–∫–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ DEPLOYMENT.md      # –î–µ–ø–ª–æ–π: Render + Neon + Yandex S3
‚îÇ   ‚îú‚îÄ‚îÄ architecture.md
‚îÇ   ‚îú‚îÄ‚îÄ sql/
‚îÇ   ‚îî‚îÄ‚îÄ reports/           # Implementation reports (moved from root)
‚îú‚îÄ‚îÄ contracts/             # OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ server/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile         # Multi-stage production build
‚îÇ   ‚îú‚îÄ‚îÄ cmd/api/           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ API —Å–µ—Ä–≤–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ cmd/migrate/       # –ú–∏–≥—Ä–∞—Ü–∏–∏ (goose)
‚îÇ   ‚îú‚îÄ‚îÄ cmd/smoke/         # E2E smoke tests
‚îÇ   ‚îú‚îÄ‚îÄ internal/          # –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–∞–∫–µ—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ migrations/        # SQL –º–∏–≥—Ä–∞—Ü–∏–∏ (goose)
‚îÇ   ‚îî‚îÄ‚îÄ go.mod
‚îú‚îÄ‚îÄ ios/                   # iOS SwiftUI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ HealthHub/
‚îî‚îÄ‚îÄ scripts/               # Shell-—Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è dev
```

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–ª–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: **[docs/INDEX.md](docs/INDEX.md)**

| –î–æ–∫—É–º–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| [docs/QUICK_SETUP.md](docs/QUICK_SETUP.md) | **üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∑–∞ 5 –º–∏–Ω—É—Ç** ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è |
| [docs/ENV_TROUBLESHOOTING.md](docs/ENV_TROUBLESHOOTING.md) | **üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º** —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è |
| [server/.env.example](server/.env.example) | –ü–æ–ª–Ω—ã–π —à–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–æ –≤—Å–µ–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ |
| [ios/PRODUCTION_SETUP.md](ios/PRODUCTION_SETUP.md) | **üì± –ù–∞—Å—Ç—Ä–æ–π–∫–∞ iOS** –Ω–∞ production —Å–µ—Ä–≤–µ—Ä |
| [docs/iOS_PRODUCTION_TESTING.md](docs/iOS_PRODUCTION_TESTING.md) | **üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ iOS** —Å production —Å–µ—Ä–≤–µ—Ä–æ–º |
| [docs/DEPLOYMENT.md](docs/DEPLOYMENT.md) | –ü–æ—à–∞–≥–æ–≤—ã–π –¥–µ–ø–ª–æ–π –Ω–∞ Render + Neon + Yandex S3 |
| [docs/architecture.md](docs/architecture.md) | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ |
| [docs/reports/](docs/reports/) | Implementation reports –ø–æ –∫–∞–∂–¥–æ–π —Ñ–∏—á–µ |

## Deploy (Render)

Backend –≥–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é –Ω–∞ **[Render](https://render.com)** —Å **Neon PostgreSQL** –∏ **Yandex S3**.

**–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:**

1. –§–æ—Ä–∫–Ω–∏ —Ä–µ–ø–æ ‚Üí –ø–æ–¥–∫–ª—é—á–∏ –∫ Render Dashboard ‚Üí **New ‚Üí Blueprint** ‚Üí `render.yaml` –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
2. –ó–∞–ø–æ–ª–Ω–∏ —Å–µ–∫—Ä–µ—Ç—ã (DB URLs, S3 –∫–ª—é—á–∏, SMTP).
3. Deploy ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏ –∑–∞–ø—É—Å—Ç—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ.

**–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** [docs/DEPLOYMENT.md](docs/DEPLOYMENT.md)

**–ö–ª—é—á–µ–≤—ã–µ env vars –¥–ª—è production:**

```
APP_ENV=production
AUTH_MODE=dev  AUTH_REQUIRED=1  EMAIL_AUTH_ENABLED=1
DATABASE_URL_POOLED=...  DATABASE_URL_DIRECT=...
BLOB_MODE=s3  REPORTS_MODE=s3  S3_*=...
EMAIL_SENDER_MODE=smtp  SMTP_*=...
JWT_SECRET=<random>  RUN_MIGRATIONS_ON_STARTUP=1
```

> **–ü–æ—á–µ–º—É AUTH_MODE=dev?** ‚Äî –≤–∫–ª—é—á–∞–µ—Ç JWT-–≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ Email OTP. SIWA –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ (`AUTH_MODE=siwa`). –°–º. [docs/DEPLOYMENT.md ¬ß –ü–æ—á–µ–º—É AUTH_MODE=dev](docs/DEPLOYMENT.md#–ø–æ—á–µ–º—É-auth_modedev-–∞-–Ω–µ-siwa).

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:**

```bash
# Health check
curl https://your-app.onrender.com/healthz

# Smoke tests
API_BASE_URL=https://your-app.onrender.com SMOKE_TOKEN=eyJ... make smoke
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Go**: 1.23+ (–∏–ª–∏ 1.22+)
- **Xcode**: 16+ –¥–ª—è iOS 18
- **PostgreSQL**: –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (Neon DATABASE_URL)

## –ó–∞–ø—É—Å–∫ Backend

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd server
go mod download
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è

> üìö **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: [QUICK_SETUP.md](docs/QUICK_SETUP.md) ‚Äî –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ  
> üîß **–ü—Ä–æ–±–ª–µ–º—ã?** [ENV_TROUBLESHOOTING.md](docs/ENV_TROUBLESHOOTING.md) ‚Äî —Ä–µ—à–µ–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –æ—à–∏–±–æ–∫

1. –°–∫–æ–ø–∏—Ä—É–π `.env.example`:
```bash
cd server
cp .env.example .env
```

2. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ó–∞–ø–æ–ª–Ω–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ë–î –≤ `.env` –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL (Neon):

```bash
# –ü—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî –æ–¥–∏–Ω URL:
DATABASE_URL=postgresql://user:password@host:5432/database?sslmode=require

# Neon / PgBouncer ‚Äî –¥–≤–∞ URL:
DATABASE_URL_POOLED=postgresql://user:pass@ep-cool-name-pooler.region.aws.neon.tech/db?sslmode=require
DATABASE_URL_DIRECT=postgresql://user:pass@ep-cool-name.region.aws.neon.tech/db?sslmode=require
```

–ï—Å–ª–∏ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ë–î –ø—É—Å—Ç—ã ‚Äî —Å–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç in-memory storage (–ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏).

#### Pooled vs Direct (Neon / Supabase)

| | Pooled | Direct |
|---|---|---|
| **–ö–æ–≥–¥–∞** | Runtime –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | –ú–∏–≥—Ä–∞—Ü–∏–∏, DDL, –¥–ª–∏–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ |
| **–ö–æ–ª-–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π** | –ú–Ω–æ–≥–æ –∫–æ—Ä–æ—Ç–∫–∏—Ö (PgBouncer) | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–æ –ø–ª–∞–Ω–æ–º —Ö–æ—Å—Ç–∏–Ω–≥–∞ |
| **Host (Neon)** | —Å–æ–¥–µ—Ä–∂–∏—Ç `-pooler` | –±–µ–∑ `-pooler` |

–°–µ—Ä–≤–µ—Ä –≤—ã–±–∏—Ä–∞–µ—Ç runtime URL –≤ –ø–æ—Ä—è–¥–∫–µ: `DATABASE_URL_POOLED` ‚Üí `DATABASE_URL` ‚Üí `DATABASE_URL_DIRECT`.
–î–ª—è –º–∏–≥—Ä–∞—Ü–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: `DATABASE_URL_DIRECT` ‚Üí `DATABASE_URL` ‚Üí `DATABASE_URL_POOLED` (—Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º).

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
cd server
go run ./cmd/api
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ `localhost:8080`.

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ü–æ—Ä—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 8080)
PORT=9000 go run ./cmd/api

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
DATABASE_URL="postgresql://user:pass@host/dbname?sslmode=require" go run ./cmd/api

# –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é debug)
LOG_LEVEL=info go run ./cmd/api

# –û–∫—Ä—É–∂–µ–Ω–∏–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é local)
APP_ENV=prod go run ./cmd/api
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# Health check
curl http://localhost:8080/healthz
# –û—Ç–≤–µ—Ç: {"status":"ok"}

# –°–ø–∏—Å–æ–∫ –ø—Ä–æ—Ñ–∏–ª–µ–π
curl http://localhost:8080/v1/profiles
# –û—Ç–≤–µ—Ç: {"profiles":[{"id":"...","owner_user_id":"default","type":"owner","name":"–Ø",...}]}

# –°–æ–∑–¥–∞–Ω–∏–µ guest –ø—Ä–æ—Ñ–∏–ª—è
curl -X POST http://localhost:8080/v1/profiles \
  -H "Content-Type: application/json" \
  -d '{"type":"guest","name":"–ì–æ—Å—Ç—å 1"}'

# –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (–∑–∞–º–µ–Ω–∏ {id} –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π UUID)
curl -X DELETE http://localhost:8080/v1/profiles/{id}

# –ë–∞—Ç—á–µ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è)
curl -X POST http://localhost:8080/v1/sync/batch \
  -H "Content-Type: application/json" \
  -d '{
    "profile_id": "OWNER_UUID",
    "daily": [{
      "date": "2026-02-12",
      "sleep": {
        "total_minutes": 480,
        "stages": {"rem": 120, "deep": 90, "core": 210, "awake": 60}
      },
      "activity": {
        "steps": 10000,
        "active_energy_kcal": 500,
        "exercise_min": 30,
        "stand_hours": 12,
        "distance_km": 7.5
      },
      "nutrition": {
        "energy_kcal": 2000,
        "protein_g": 80,
        "fat_g": 60,
        "carbs_g": 250,
        "calcium_mg": 800
      },
      "temperature": {
        "wrist_c_avg": 36.5,
        "wrist_c_min": 36.2,
        "wrist_c_max": 36.8
      }
    }],
    "hourly": [{
      "hour": "2026-02-12T10:00:00Z",
      "steps": 1500,
      "hr": {"min": 60, "max": 85, "avg": 72}
    }],
    "sessions": {
      "sleep_segments": [{
        "start": "2026-02-11T23:00:00Z",
        "end": "2026-02-12T07:00:00Z",
        "stage": "core"
      }],
      "workouts": [{
        "start": "2026-02-12T08:00:00Z",
        "end": "2026-02-12T09:00:00Z",
        "label": "run",
        "calories_kcal": 300
      }]
    }
  }'

# –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –∑–∞ –ø–µ—Ä–∏–æ–¥
curl "http://localhost:8080/v1/metrics/daily?profile_id=OWNER_UUID&from=2026-02-05&to=2026-02-12"

# –ü–æ–ª—É—á–µ–Ω–∏–µ —á–∞—Å–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ (—à–∞–≥–∏) –∑–∞ –¥–µ–Ω—å
curl "http://localhost:8080/v1/metrics/hourly?profile_id=OWNER_UUID&date=2026-02-12&metric=steps"

# –ü–æ–ª—É—á–µ–Ω–∏–µ —á–∞—Å–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ (–ø—É–ª—å—Å) –∑–∞ –¥–µ–Ω—å
curl "http://localhost:8080/v1/metrics/hourly?profile_id=OWNER_UUID&date=2026-02-12&metric=hr"

# –ü–æ–ª—É—á–∏—Ç—å owner profile ID –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
PROFILE_ID=$(curl -s http://localhost:8080/v1/profiles | jq -r '.profiles[0].id')
echo "Profile ID: $PROFILE_ID"

# –°–æ–∑–¥–∞–Ω–∏–µ —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —á–µ–∫–∏–Ω–∞ (heredoc –ë–ï–ó –∫–∞–≤—ã—á–µ–∫ –¥–ª—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö)
curl -X POST http://localhost:8080/v1/checkins \
  -H 'Content-Type: application/json' \
  --data-binary @- <<JSON
{
  "profile_id": "$PROFILE_ID",
  "date": "2026-02-12",
  "type": "morning",
  "score": 4,
  "tags": [],
  "note": "–ß—É–≤—Å—Ç–≤—É—é —Å–µ–±—è —Ö–æ—Ä–æ—à–æ"
}
JSON

# –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—á–µ—Ä–Ω–µ–≥–æ —á–µ–∫–∏–Ω–∞ —Å –Ω–∏–∑–∫–∏–º score –∏ —Ç–µ–≥–∞–º–∏
curl -X POST http://localhost:8080/v1/checkins \
  -H 'Content-Type: application/json' \
  --data-binary @- <<JSON
{
  "profile_id": "$PROFILE_ID",
  "date": "2026-02-12",
  "type": "evening",
  "score": 2,
  "tags": ["—Å—Ç—Ä–µ—Å—Å", "—É—Å—Ç–∞–ª–æ—Å—Ç—å"],
  "note": "–¢—è–∂–µ–ª—ã–π –¥–µ–Ω—å"
}
JSON

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —á–µ–∫–∏–Ω–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥
curl "http://localhost:8080/v1/checkins?profile_id=$PROFILE_ID&from=2026-02-01&to=2026-02-28" | jq .

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–æ–¥–∫–∏ –¥–Ω—è (daily metrics + checkins)
curl "http://localhost:8080/v1/feed/day?profile_id=$PROFILE_ID&date=2026-02-12" | jq .

# ‚îÄ‚îÄ‚îÄ‚îÄ Sources API (—Ñ–æ—Ç–æ/—Å—Å—ã–ª–∫–∏/–∑–∞–º–µ—Ç–∫–∏) ‚îÄ‚îÄ‚îÄ‚îÄ

# –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –∫ —á–µ–∫–∏–Ω—É
curl -X POST http://localhost:8080/v1/sources/image \
  -F "profile_id=$PROFILE_ID" \
  -F "checkin_id=CHECKIN_UUID" \
  -F "title=–§–æ—Ç–æ –¥–Ω—è" \
  -F "file=@./photo.jpg;type=image/jpeg"

# –°–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏
curl -X POST http://localhost:8080/v1/sources \
  -H 'Content-Type: application/json' \
  --data-binary @- <<JSON
{
  "profile_id": "$PROFILE_ID",
  "kind": "link",
  "title": "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è —Å—Ç–∞—Ç—å—è",
  "url": "https://example.com/article"
}
JSON

# –°–ø–∏—Å–æ–∫ sources –¥–ª—è checkin
curl "http://localhost:8080/v1/sources?profile_id=$PROFILE_ID&checkin_id=CHECKIN_UUID" | jq .

# –°–∫–∞—á–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
curl -o downloaded.jpg "http://localhost:8080/v1/sources/SOURCE_UUID/download"

# –£–¥–∞–ª–∏—Ç—å source
curl -X DELETE "http://localhost:8080/v1/sources/SOURCE_UUID"

# ‚îÄ‚îÄ‚îÄ‚îÄ Inbox/Notifications API (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è) ‚îÄ‚îÄ‚îÄ‚îÄ

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–π –¥–∞—Ç—ã
jq -n --arg pid "$PROFILE_ID" '{
  profile_id:$pid,
  date:"2026-02-13",
  client_time_zone:"Europe/Moscow",
  now:"2026-02-13T22:00:00+03:00",
  thresholds:{sleep_min_minutes:420,steps_min:6000,active_energy_min_kcal:200}
}' | curl -X POST http://localhost:8080/v1/inbox/generate \
  -H 'Content-Type: application/json' --data-binary @- | jq .

# –ü–æ–ª—É—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
curl "http://localhost:8080/v1/inbox/unread-count?profile_id=$PROFILE_ID" | jq .

# –°–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–≤—Å–µ)
curl "http://localhost:8080/v1/inbox?profile_id=$PROFILE_ID&limit=20" | jq .

# –°–ø–∏—Å–æ–∫ —Ç–æ–ª—å–∫–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
curl "http://localhost:8080/v1/inbox?profile_id=$PROFILE_ID&only_unread=true" | jq .

# –û—Ç–º–µ—Ç–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
NOTIF_ID=$(curl -s "http://localhost:8080/v1/inbox?profile_id=$PROFILE_ID&only_unread=true&limit=1" | jq -r '.notifications[0].id')
curl -X POST http://localhost:8080/v1/inbox/mark-read \
  -H 'Content-Type: application/json' \
  --data-binary @- <<JSON
{
  "profile_id": "$PROFILE_ID",
  "ids": ["$NOTIF_ID"]
}
JSON

# –û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
curl -X POST http://localhost:8080/v1/inbox/mark-all-read \
  -H 'Content-Type: application/json' \
  --data-binary @- <<JSON
{
  "profile_id": "$PROFILE_ID"
}
JSON
```

**–í–∞–∂–Ω–æ**: –í –ø—Ä–∏–º–µ—Ä–∞—Ö –≤—ã—à–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `jq` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è profile_id –∏ –∫—Ä–∞—Å–∏–≤–æ–≥–æ –≤—ã–≤–æ–¥–∞ JSON. –£—Å—Ç–∞–Ω–æ–≤–∏ jq –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç: `brew install jq` (macOS) –∏–ª–∏ `apt install jq` (Linux).

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ heredoc –¥–ª—è JSON**: Heredoc –±–µ–∑ –∫–∞–≤—ã—á–µ–∫ (`<<JSON`) –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ shell ($PROFILE_ID). –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –ª–∏—Ç–µ—Ä–∞–ª—å–Ω—ã–π JSON –±–µ–∑ –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏, –∏—Å–ø–æ–ª—å–∑—É–π `<<'JSON'` —Å –æ–¥–∏–Ω–∞—Ä–Ω—ã–º–∏ –∫–∞–≤—ã—á–∫–∞–º–∏.

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
cd server
go test ./... -v
```

### Database migrations

–ú–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `goose` (SQL-—Ñ–∞–π–ª—ã –≤ `server/migrations`).

–ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
cd server
DATABASE_URL_DIRECT="postgres://user:pass@ep-xxx.neon.tech/dbname?sslmode=require" go run ./cmd/migrate up
DATABASE_URL_DIRECT="postgres://user:pass@ep-xxx.neon.tech/dbname?sslmode=require" go run ./cmd/migrate status
```

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–æ–º–∞–Ω–¥—ã: `up`, `status`, `down`.

–í—ã–±–æ—Ä URL –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π:
1. `DATABASE_URL_DIRECT` (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ)
2. `DATABASE_URL`
3. `DATABASE_URL_POOLED` (—Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º; –¥–ª—è DDL –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–î–ª—è runtime API URL –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –≤ –ø–æ—Ä—è–¥–∫–µ:
`DATABASE_URL_POOLED` ‚Üí `DATABASE_URL` ‚Üí `DATABASE_URL_DIRECT`.

–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ API:

```bash
cd server
RUN_MIGRATIONS_ON_STARTUP=1 \
DATABASE_URL_DIRECT="postgres://user:pass@ep-xxx.neon.tech/dbname?sslmode=require" \
go run ./cmd/api
```

–ï—Å–ª–∏ `RUN_MIGRATIONS_ON_STARTUP=1` –∏ `DATABASE_URL_DIRECT` –Ω–µ –∑–∞–¥–∞–Ω, —Å–µ—Ä–≤–µ—Ä –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Å FATAL.

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π —Å–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Postgres storage.

## –ó–∞–ø—É—Å–∫ iOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ Xcode –ø—Ä–æ–µ–∫—Ç–∞

1. –û—Ç–∫—Ä–æ–π Xcode
2. –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç: **App** (iOS, SwiftUI)
3. –ù–∞–∑–≤–∞–Ω–∏–µ: `HealthHub`
4. Bundle ID: `com.example.healthhub` (–∏–ª–∏ —Å–≤–æ–π)
5. –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è: **iOS 18.0**
6. –°–æ—Ö—Ä–∞–Ω–∏ –ø—Ä–æ–µ–∫—Ç –≤ –ø–∞–ø–∫—É `ios/`

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –¥–æ–±–∞–≤—å —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã –∏ –ø–∞–ø–∫–∏ –≤ Xcode:

1. **–ó–∞–º–µ–Ω–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã**:
   - `HealthHubApp.swift` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π —Ñ–∞–π–ª –∏–∑ `ios/HealthHub/HealthHub/`
   - `ContentView.swift` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π —Ñ–∞–π–ª –∏–∑ `ios/HealthHub/HealthHub/`

2. **–î–æ–±–∞–≤—å –Ω–æ–≤—ã–µ –ø–∞–ø–∫–∏** (Right-click –Ω–∞ `HealthHub` –≤ Project Navigator ‚Üí Add Files):
   - `Features/` (—Å –ø–æ–¥–ø–∞–ø–∫–∞–º–∏ Feed, Metrics, Activity, Chat –∏ –≤—Å–µ–º–∏ .swift —Ñ–∞–π–ª–∞–º–∏)
   - `Models/` (—Å `ProfileDTO.swift`, `MetricsDTO.swift`, `CheckinDTO.swift`, `FeedDTO.swift`)
   - `Core/Networking/` (—Å `APIClient.swift`)
   - `Core/HealthKit/` (—Å `HealthKitManager.swift`)
   - `Core/Config/` (—Å `AppConfig.swift`)

   **–í–∞–∂–Ω–æ**: –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤—ã–±–µ—Ä–∏ **"Create groups"**, –∞ –Ω–µ "Create folder references".

3. **–ù–∞—Å—Ç—Ä–æ–π HealthKit** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏):
   - –°–º. –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é: `ios/HEALTHKIT_SETUP.md`
   - –ö—Ä–∞—Ç–∫–∞—è –≤–µ—Ä—Å–∏—è:
     1. Target ‚Üí Signing & Capabilities ‚Üí **+ Capability** ‚Üí HealthKit
     2. Info.plist ‚Üí –¥–æ–±–∞–≤—å `NSHealthShareUsageDescription`
     3. –¢–µ—Å—Ç–∏—Ä—É–π –Ω–∞ **—Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ** (—Å–∏–º—É–ª—è—Ç–æ—Ä –æ–≥—Ä–∞–Ω–∏—á–µ–Ω)

4. **–ù–∞—Å—Ç—Ä–æ–π background sync** (HealthKit observer + BG task):
   - –°–º. –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é: `ios/BACKGROUND_SYNC.md`
   - –ú–∏–Ω–∏–º—É–º:
     1. Target ‚Üí Signing & Capabilities ‚Üí **Background Modes**
     2. –í–∫–ª—é—á–∏ `Background fetch` (–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ `Background processing`)
     3. –†–∞–∑—Ä–µ—à–∏ Health –¥–æ—Å—Ç—É–ø—ã –∏ —Ç–µ—Å—Ç–∏—Ä—É–π –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ

5. **–ù–∞—Å—Ç—Ä–æ–π API Base URL –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞**:
   - –î–ª—è —Å–∏–º—É–ª—è—Ç–æ—Ä–∞: –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `http://localhost:8080` (—Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
   - –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:
     1. –£–∑–Ω–∞–π LAN IP –∞–¥—Ä–µ—Å —Ç–≤–æ–µ–≥–æ Mac: `ifconfig | grep "inet " | grep -v 127.0.0.1`
     2. –û—Ç–∫—Ä–æ–π `Info.plist` –≤ Xcode
     3. –î–æ–±–∞–≤—å –Ω–æ–≤—ã–π –∫–ª—é—á `API_BASE_URL` (String) —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º `http://YOUR_LAN_IP:8080`
     4. –ü—Ä–∏–º–µ—Ä: `http://192.168.1.100:8080`
     5. –£–±–µ–¥–∏—Å—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ Mac –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏
   - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `AppConfig.apiBaseURL` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–±–æ—Ä–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ URL

### –ó–∞–ø—É—Å–∫

1. **–ó–∞–ø—É—Å—Ç–∏ backend —Å–µ—Ä–≤–µ—Ä** (–≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ):
   ```bash
   cd server && go run ./cmd/api
   ```

2. **–ó–∞–ø—É—Å—Ç–∏ iOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** –≤ Xcode:
   - –û—Ç–∫—Ä–æ–π `ios/HealthHub/HealthHub.xcodeproj`
   - –í—ã–±–µ—Ä–∏ —Å–∏–º—É–ª—è—Ç–æ—Ä (iPhone 16 –∏–ª–∏ –Ω–æ–≤–µ–µ)
   - –ù–∞–∂–º–∏ **Run** (Cmd+R)

3. **–ü—Ä–æ–≤–µ—Ä—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
   - **–í–∫–ª–∞–¥–∫–∞ "–õ–µ–Ω—Ç–∞"**: —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞, –ø—Ä–æ—Ñ–∏–ª–∏, CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
   - **–í–∫–ª–∞–¥–∫–∞ "–ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏"**:
     - **HealthKit —Å–µ–∫—Ü–∏—è**:
       - –ù–∞–∂–º–∏ "–ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ Health" ‚Üí —Ä–∞–∑—Ä–µ—à–∏ –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º (Steps, HR, Weight, Sleep, Workouts, Nutrition, Activity, Temperature)
       - –ù–∞–∂–º–∏ "Sync Today (HealthKit)" ‚Üí —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
       - –ù–∞–∂–º–∏ "Sync Last 7 Days (HealthKit)" ‚Üí —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π (–≤–∫–ª—é—á–∞—è Sleep, Workouts, Nutrition, Activity, Temperature)
     - **Server —Å–µ–∫—Ü–∏—è**:
       - –ù–∞–∂–º–∏ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–Ω–µ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏" ‚Üí –ø–æ–∫–∞–∂–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞
       - –ù–∞–∂–º–∏ "–ó–∞–≥—Ä—É–∑–∏—Ç—å —á–∞—Å–æ–≤—ã–µ HR" ‚Üí –ø–æ–∫–∞–∂–µ—Ç –ø–æ—á–∞—Å–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—É–ª—å—Å–∞
     - **–ì—Ä–∞—Ñ–∏–∫–∏**: Steps, Weight, Resting HR, Sleep, Active Energy (—Å–∂–∏–≥–∞–µ–º–∞—è —ç–Ω–µ—Ä–≥–∏—è)
     - **DEBUG** (—Ç–æ–ª—å–∫–æ –≤ debug build): –º–æ–∫-–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## iOS: Export reports

–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á—ë—Ç–æ–≤ (PDF/CSV) –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –≤–∫–ª–∞–¥–∫–µ **"–ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏"**:

1. –û—Ç–∫—Ä–æ–π –≤–∫–ª–∞–¥–∫—É **"–ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏"** –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
2. –í—ã–±–µ—Ä–∏ –ø–µ—Ä–∏–æ–¥ (7D / 30D / 90D)
3. –í–Ω–∏–∑—É –ø–æ–¥ –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ –Ω–∞–∂–º–∏ **"–≠–∫—Å–ø–æ—Ä—Ç PDF"** –∏–ª–∏ **"–≠–∫—Å–ø–æ—Ä—Ç CSV"**
4. –î–æ–∂–¥–∏—Å—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è ‚Äî –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–Ω—ã–π Share Sheet
5. –ü–æ–¥–µ–ª–∏—Å—å —Ñ–∞–π–ª–æ–º –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–∏ –≤ Files

**–ò—Å—Ç–æ—Ä–∏—è –æ—Ç—á—ë—Ç–æ–≤**: –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –æ—Ç—á—ë—Ç–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Å–µ–∫—Ü–∏–∏ "–ò—Å—Ç–æ—Ä–∏—è –æ—Ç—á—ë—Ç–æ–≤". –ö–∞–∂–¥—ã–π –º–æ–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å.

**–î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞**: —É–±–µ–¥–∏—Å—å, —á—Ç–æ `API_BASE_URL` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Info.plist (–Ω–∞–ø—Ä–∏–º–µ—Ä, `http://192.168.1.100:8080`). –ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Äî —Å–º. —Å–µ–∫—Ü–∏—é "–ó–∞–ø—É—Å–∫ iOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è" –≤—ã—à–µ.

## iOS: Attachments (Photos)

–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ –∫ —á–µ–∫–∏–Ω–∞–º –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ **"–õ–µ–Ω—Ç–∞"**:

1. –û—Ç–∫—Ä–æ–π –≤–∫–ª–∞–¥–∫—É **"–õ–µ–Ω—Ç–∞"** –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
2. –í—ã–±–µ—Ä–∏ –¥–∞—Ç—É (—Å–µ–≥–æ–¥–Ω—è –∏–ª–∏ –ø—Ä–æ—à–ª—ã–µ –¥–Ω–∏)
3. –ù–∞–∂–º–∏ **"–î–æ–±–∞–≤–∏—Ç—å —É—Ç—Ä–µ–Ω–Ω–∏–π/–≤–µ—á–µ—Ä–Ω–∏–π —á–µ–∫-–∏–Ω"** –∏–ª–∏ **"–ò–∑–º–µ–Ω–∏—Ç—å"** (–µ—Å–ª–∏ —á–µ–∫–∏–Ω —É–∂–µ –µ—Å—Ç—å)
4. –ó–∞–ø–æ–ª–Ω–∏ –æ—Ü–µ–Ω–∫—É (1-5), —Ç–µ–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ), –∑–∞–º–µ—Ç–∫—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
5. **–°–Ω–∞—á–∞–ª–∞ –Ω–∞–∂–º–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"** ‚Äî —á–µ–∫–∏–Ω –ø–æ—è–≤–∏—Ç—Å—è –≤ –ª–µ–Ω—Ç–µ
6. –ù–∞–∂–º–∏ **"–ò–∑–º–µ–Ω–∏—Ç—å"** —Å–Ω–æ–≤–∞ ‚Äî —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–∞ —Å–µ–∫—Ü–∏—è **"–§–æ—Ç–æ"**
7. –ù–∞–∂–º–∏ **"–í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ"** (PhotosPicker) ‚Üí –≤—ã–±–µ—Ä–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
8. –î–æ–∂–¥–∏—Å—å –∑–∞–≥—Ä—É–∑–∫–∏ ‚Äî —Ñ–æ—Ç–æ –ø–æ—è–≤–∏—Ç—Å—è –≤ –ø—Ä–µ–≤—å—é (–¥–æ 4 —à—Ç—É–∫)
9. –¢–∞–ø –ø–æ —Ñ–æ—Ç–æ –æ—Ç–∫—Ä–æ–µ—Ç full-screen preview
10. –£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ: –Ω–∞–∂–º–∏ –∏–∫–æ–Ω–∫—É **X** –Ω–∞ –ø—Ä–µ–≤—å—é ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–¥–∏ —É–¥–∞–ª–µ–Ω–∏–µ

**–õ–∏–º–∏—Ç—ã:**
- –ú–∞–∫—Å–∏–º—É–º 4 —Ñ–æ—Ç–æ –Ω–∞ –æ–¥–∏–Ω —á–µ–∫–∏–Ω

## iOS: Inbox (–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)

–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ **"–õ–µ–Ω—Ç–∞"** (–∏–∫–æ–Ω–∫–∞ –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫–∞ —Å –±–µ–π–¥–∂–µ–º):

1. –û—Ç–∫—Ä–æ–π –≤–∫–ª–∞–¥–∫—É **"–õ–µ–Ω—Ç–∞"**
2. –í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –Ω–∞–∂–º–∏ –Ω–∞ **–∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫** (bell icon)
   - –ö—Ä–∞—Å–Ω—ã–π –±–µ–π–¥–∂ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
3. –û—Ç–∫—Ä–æ–µ—Ç—Å—è —ç–∫—Ä–∞–Ω **"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"** —Å–æ —Å–ø–∏—Å–∫–æ–º:
   - **–ü—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ** (—Å–µ—Ä—ã–µ, –∑–∞—Ç–µ–º–Ω—ë–Ω–Ω—ã–µ)
   - **–ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ** (–∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç, —Å–∏–Ω—è—è —Ç–æ—á–∫–∞)
4. –°–≤–∞–π–ø –≤–ª–µ–≤–æ –ø–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—é ‚Üí **"–ü—Ä–æ—á–∏—Ç–∞–Ω–æ"** (–æ—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ)
5. –ö–Ω–æ–ø–∫–∞ **checkmark.circle** –≤ toolbar ‚Üí **"–û—Ç–º–µ—Ç–∏—Ç—å –≤—Å—ë –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º"**

**–ö–∞–∫ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ Feed/day (–¥–ª—è —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –¥–∞—Ç—ã)
- –ù–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç—Ä–∏–∫ –∏ —á–µ–∫-–∏–Ω–æ–≤ –∑–∞ –¥–µ–Ω—å
- –ü—Ä–∞–≤–∏–ª–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–ø—Ä–æ—Å—Ç—ã–µ, –±–µ–∑ AI):
  - **–ü–ª–æ—Ö–æ–π —Å–æ–Ω** (warn): < 7 —á–∞—Å–æ–≤ —Å–Ω–∞
  - **–ù–∏–∑–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** (info/warn): < 6000 —à–∞–≥–æ–≤ –∏–ª–∏ < 200 –∫–∫–∞–ª –∞–∫—Ç–∏–≤–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏
  - **–ü—Ä–æ–ø—É—â–µ–Ω —É—Ç—Ä–µ–Ω–Ω–∏–π —á–µ–∫-–∏–Ω** (info): –ø–æ—Å–ª–µ 12:00, –µ—Å–ª–∏ –Ω–µ—Ç —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —á–µ–∫-–∏–Ω–∞
  - **–ü—Ä–æ–ø—É—â–µ–Ω –≤–µ—á–µ—Ä–Ω–∏–π —á–µ–∫-–∏–Ω** (info): –ø–æ—Å–ª–µ 21:30, –µ—Å–ª–∏ –Ω–µ—Ç –≤–µ—á–µ—Ä–Ω–µ–≥–æ —á–µ–∫-–∏–Ω–∞
- –õ–∏–º–∏—Ç: –º–∞–∫—Å–∏–º—É–º 4 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞ –æ–¥–Ω—É –¥–∞—Ç—É (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: warn > info)
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è (unique –ø–æ profile_id + kind + source_date)

**ENV –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (`server/.env.example`):
```bash
NOTIFICATIONS_MAX_PER_DAY=4
DEFAULT_SLEEP_MIN_MINUTES=420
DEFAULT_STEPS_MIN=6000
DEFAULT_ACTIVE_ENERGY_MIN_KCAL=200
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–π HealthKit –¥–∞–Ω–Ω—ã–µ ‚Üí –æ—Ç–∫—Ä–æ–π –õ–µ–Ω—Ç—É ‚Üí –Ω–∞–∂–º–∏ –Ω–∞ –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫
2. –ï—Å–ª–∏ —Å–æ–Ω < 7—á –∏–ª–∏ —à–∞–≥–æ–≤ < 6000 ‚Äî —É–≤–∏–¥–∏—à—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
3. –°–≤–∞–π–ø ‚Üí "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ" ‚Üí –±–µ–π–¥–∂ —É–º–µ–Ω—å—à–∏—Ç—Å—è

## iOS: Smart Local Reminders

–õ–æ–∫–∞–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ, –∫–æ—Ç–æ—Ä—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å server inbox (–±–µ–∑ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π).

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –ò—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã ‚Äî —Å–µ—Ä–≤–µ—Ä–Ω—ã–π inbox (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `/v1/inbox/generate`)
- –õ–æ–∫–∞–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–ª–∞–Ω–∏—Ä—É—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è (–Ω–µ —Å—Ä–∞–∑—É)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: max N —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ –¥–µ–Ω—å, —Ä–µ–∂–∏–º ¬´–ù–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å¬ª

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ (–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏):**
1. –û—Ç–∫—Ä–æ–π –≤–∫–ª–∞–¥–∫—É **"–õ–µ–Ω—Ç–∞"**
2. –ù–∞–∂–º–∏ **gearshape** (–∏–∫–æ–Ω–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫) —Ä—è–¥–æ–º —Å –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫–æ–º
3. –í–∫–ª—é—á–∏ **"–í–∫–ª—é—á–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è"**
4. –†–∞–∑—Ä–µ—à–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (iOS prompt)
5. –ù–∞—Å—Ç—Ä–æ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
   - **–†–µ–∂–∏–º ¬´–ù–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å¬ª**: –ø–µ—Ä–∏–æ–¥, –∫–æ–≥–¥–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã
   - **–ú–∞–∫—Å–∏–º—É–º –≤ –¥–µ–Ω—å**: –ª–∏–º–∏—Ç –ª–æ–∫–∞–ª—å–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (default 4)
   - **–í—Ä–µ–º—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π**: –∫–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞
     - –£—Ç—Ä–µ–Ω–Ω–∏–π —á–µ–∫-–∏–Ω: 12:00
     - –í–µ—á–µ—Ä–Ω–∏–π —á–µ–∫-–∏–Ω: 21:30
     - –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ): 18:00
     - –°–æ–Ω (–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ): 11:00

**–ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É—é—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ Feed/day (–¥–ª—è —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –¥–∞—Ç—ã)
- Rate limiting: –Ω–µ —á–∞—â–µ 1 —Ä–∞–∑–∞ –≤ 30 –º–∏–Ω—É—Ç
- –¢–æ–ª—å–∫–æ –¥–ª—è –±—É–¥—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (–ø—Ä–æ—à–µ–¥—à–∏–µ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è)

**–¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**
- `missing_morning_checkin` ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –≤ 12:00
- `missing_evening_checkin` ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –≤ 21:30
- `low_activity` ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –≤ 18:00
- `low_sleep` ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –≤ 11:00

**–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è:**
- Warn (–ø–ª–æ—Ö–æ–π —Å–æ–Ω, –Ω–∏–∑–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å) –≤—ã—à–µ Info (–ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —á–µ–∫-–∏–Ω—ã)
- –ï—Å–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –±–æ–ª—å—à–µ maxLocalPerDay ‚Äî –±–µ—Ä—É—Ç—Å—è –ø–µ—Ä–≤—ã–µ N –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π **"–õ–µ–Ω—Ç–∞"** ‚Üí **gearshape** ‚Üí –≤–∫–ª—é—á–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
2. –†–∞–∑—Ä–µ—à–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (iOS prompt)
3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–π HealthKit: **"–ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏"** ‚Üí **"Sync Today"**
4. –û—Ç–∫—Ä–æ–π **"–õ–µ–Ω—Ç–∞"** ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è inbox + –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
5. –ü—Ä–æ–≤–µ—Ä—å –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
   - iOS Settings ‚Üí Notifications ‚Üí HealthHub ‚Üí Scheduled Notifications
6. –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∞:
   - –£—Å—Ç–∞–Ω–æ–≤–∏ –≤—Ä–µ–º—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –Ω–∞ +1 –º–∏–Ω—É—Ç—É –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ
   - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ—Ç–∫—Ä–æ–π –õ–µ–Ω—Ç—É –∑–∞–Ω–æ–≤–æ –∏–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–π —Å–Ω–æ–≤–∞)
7. –£–≤–∏–¥–∏—à—å –ª–æ–∫–∞–ª—å–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è

**–ë–µ–π–¥–∂ –Ω–∞ –∏–∫–æ–Ω–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏–∑ server inbox
- –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ unread-count
- –¢—Ä–µ–±—É–µ—Ç permission –Ω–∞ badge (–∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏)
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 10 MB (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `UPLOAD_MAX_MB`)
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: JPEG, PNG, HEIC

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –§–æ—Ç–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ JPEG (quality 0.8) –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–∞.

## iOS: Background Sync (HealthKit + Inbox)

–§–æ–Ω–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é:
- `HKObserverQuery` + `enableBackgroundDelivery` –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö HealthKit —Ç–∏–ø–æ–≤
- `BGAppRefreshTask` –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º —Ñ–æ–Ω–æ–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

–ß—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ñ–æ–Ω–µ:
1. Sync –≤ `/v1/sync/batch` –∑–∞ **—Å–µ–≥–æ–¥–Ω—è + –≤—á–µ—Ä–∞**
2. Hourly –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–∞ **—Å–µ–≥–æ–¥–Ω—è**
3. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è inbox (`/v1/inbox/generate`, `/v1/inbox`)
4. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–µ smart reminders

UI:
- –ù–∞ `Home` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å: **–ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** + `OK/–æ—à–∏–±–∫–∞`
- –í `–ù–∞—Å—Ç—Ä–æ–π–∫–∏` –µ—Å—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏:
  - `–§–æ–Ω–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è`
  - `–û–±–Ω–æ–≤–ª—è—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ —Ñ–æ–Ω–µ`

–ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
- –°–∏–º—É–ª—è—Ç–æ—Ä: Xcode ‚Üí `Debug` ‚Üí `Simulate Background Fetch`
- –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: –≤—ã–¥–∞—Ç—å Health permissions, –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ Health, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `–ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: `ios/BACKGROUND_SYNC.md`

## iOS: Sources (–°—Å—ã–ª–∫–∏ –∏ –ó–∞–º–µ—Ç–∫–∏)

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ **"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"**:

### –û—Å–Ω–æ–≤–Ω–æ–π —ç–∫—Ä–∞–Ω Sources

1. –û—Ç–∫—Ä–æ–π –≤–∫–ª–∞–¥–∫—É **"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"** –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
2. –ù–∞–∂–º–∏ **"+"** –≤ –≤–µ—Ä—Ö–Ω–µ–º –ø—Ä–∞–≤–æ–º —É–≥–ª—É ‚Üí –≤—ã–±–µ—Ä–∏ **"–°—Å—ã–ª–∫–∞"** –∏–ª–∏ **"–ó–∞–º–µ—Ç–∫–∞"**
3. –ó–∞–ø–æ–ª–Ω–∏ —Ñ–æ—Ä–º—É:
   - **–°—Å—ã–ª–∫–∞**: URL (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ), –Ω–∞–∑–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - **–ó–∞–º–µ—Ç–∫–∞**: —Ç–µ–∫—Å—Ç (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ), –Ω–∞–∑–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. –ù–∞–∂–º–∏ **"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"** ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ –ø–æ—è–≤–∏—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ
5. –¢–∞–ø –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫—É –æ—Ç–∫—Ä–æ–µ—Ç:
   - **–§–æ—Ç–æ** ‚Üí full-screen preview
   - **–°—Å—ã–ª–∫–∞** ‚Üí Safari –≤–Ω—É—Ç—Ä–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - **–ó–∞–º–µ—Ç–∫–∞** ‚Üí sheet —Å –ø–æ–ª–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
6. –£–¥–∞–ª–∏—Ç—å: swipe left –Ω–∞ —Å—Ç—Ä–æ–∫–µ ‚Üí **"–£–¥–∞–ª–∏—Ç—å"** ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–¥–∏

**–ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã:**
- –°—Ç—Ä–æ–∫–∞ –ø–æ–∏—Å–∫–∞: –∏—â–µ—Ç –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, —Ç–µ–∫—Å—Ç—É, URL (debounce 300ms)
- –§–∏–ª—å—Ç—Ä—ã: –í—Å–µ / –§–æ—Ç–æ / –°—Å—ã–ª–∫–∏ / –ó–∞–º–µ—Ç–∫–∏

### Attachments –≤ —á–µ–∫–∏–Ω–∞—Ö (–í–ª–æ–∂–µ–Ω–∏—è)

–ü–æ–º–∏–º–æ —Ñ–æ—Ç–æ, —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å —Å—Å—ã–ª–∫–∏ –∏ –∑–∞–º–µ—Ç–∫–∏ –∫ —á–µ–∫–∏–Ω–∞–º:

1. –í —Å–µ–∫—Ü–∏–∏ **"–í–ª–æ–∂–µ–Ω–∏—è"** —á–µ–∫–∏–Ω–∞ (–≤–∫–ª–∞–¥–∫–∞ "–õ–µ–Ω—Ç–∞") –¥–æ—Å—Ç—É–ø–Ω—ã –∫–Ω–æ–ø–∫–∏:
   - **"–§–æ—Ç–æ"** (PhotosPicker, –¥–æ 4 —à—Ç—É–∫)
   - **"–°—Å—ã–ª–∫–∞"** (—Ñ–æ—Ä–º–∞ —Å URL + –Ω–∞–∑–≤–∞–Ω–∏–µ)
   - **"–ó–∞–º–µ—Ç–∫–∞"** (—Ñ–æ—Ä–º–∞ —Å —Ç–µ–∫—Å—Ç–æ–º + –Ω–∞–∑–≤–∞–Ω–∏–µ)
2. **–ü—Ä–∞–≤–∏–ª–æ**: —Å–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω–∏ —á–µ–∫–∏–Ω, –∑–∞—Ç–µ–º –ø—Ä–∏–∫—Ä–µ–ø–ª—è–π –≤–ª–æ–∂–µ–Ω–∏—è
3. –í—Å–µ –≤–ª–æ–∂–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –æ–¥–Ω–æ–π —Å–µ–∫—Ü–∏–∏:
   - –§–æ—Ç–æ: –ø—Ä–µ–≤—å—é 4—Ö4
   - –°—Å—ã–ª–∫–∏/–ó–∞–º–µ—Ç–∫–∏: –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ —Å –∏–∫–æ–Ω–∫–æ–π + title/url/—Ç–µ–∫—Å—Ç
4. –£–¥–∞–ª–µ–Ω–∏–µ: trash-–∫–Ω–æ–ø–∫–∞ –Ω–∞ –∫–∞–∂–¥–æ–º –≤–ª–æ–∂–µ–Ω–∏–∏ ‚Üí confirm

**–õ–∏–º–∏—Ç—ã:**
- –§–æ—Ç–æ: –¥–æ 4 –Ω–∞ —á–µ–∫–∏–Ω
- –°—Å—ã–ª–∫–∏/–ó–∞–º–µ—Ç–∫–∏: –±–µ–∑ –ª–∏–º–∏—Ç–∞ –Ω–∞ —ç—Ç–æ–º —à–∞–≥–µ

### curl-–ø—Ä–∏–º–µ—Ä—ã Reports API

```bash
# –ü–æ–ª—É—á–∏—Ç—å profile ID
PROFILE_ID=$(curl -s http://localhost:8080/v1/profiles | jq -r '.profiles[0].id')

# –°–æ–∑–¥–∞—Ç—å PDF-–æ—Ç—á—ë—Ç –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
curl -X POST http://localhost:8080/v1/reports \
  -H 'Content-Type: application/json' \
  --data-binary @- <<JSON
{
  "profile_id": "$PROFILE_ID",
  "from": "2026-02-06",
  "to": "2026-02-12",
  "format": "pdf"
}
JSON

# –°–æ–∑–¥–∞—Ç—å CSV-–æ—Ç—á—ë—Ç
curl -X POST http://localhost:8080/v1/reports \
  -H 'Content-Type: application/json' \
  --data-binary @- <<JSON
{
  "profile_id": "$PROFILE_ID",
  "from": "2026-02-06",
  "to": "2026-02-12",
  "format": "csv"
}
JSON

# –°–ø–∏—Å–æ–∫ –æ—Ç—á—ë—Ç–æ–≤
curl "http://localhost:8080/v1/reports?profile_id=$PROFILE_ID&limit=10" | jq .

# –°–∫–∞—á–∞—Ç—å –æ—Ç—á—ë—Ç (–∑–∞–º–µ–Ω–∏ REPORT_ID)
curl -L -o report.pdf "http://localhost:8080/v1/reports/REPORT_ID/download"

# –£–¥–∞–ª–∏—Ç—å –æ—Ç—á—ë—Ç
curl -X DELETE "http://localhost:8080/v1/reports/REPORT_ID"
```

## Intakes (Water & Supplements)

–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–∏—ë–º–∞ –≤–æ–¥—ã –∏ –¥–æ–±–∞–≤–æ–∫/–≤–∏—Ç–∞–º–∏–Ω–æ–≤ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π HealthKit.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–î

```bash
cd server
DATABASE_URL_DIRECT="postgres://user:pass@host:5432/healthhub_dev?sslmode=require" go run ./cmd/migrate up
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
INTAKES_MAX_WATER_ML_PER_DAY=8000
INTAKES_WATER_DEFAULT_ADD_ML=250
INTAKES_MAX_SUPPLEMENTS=100
```

## Meal Plan (iOS)

### –î–æ—Å—Ç—É–ø

–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí **–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** (–Ω–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å) ‚Üí –≤–∫–ª–∞–¥–∫–∞ **–ü–∏—Ç–∞–Ω–∏–µ**.

–ó–¥–µ—Å—å –¥–≤–∞ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–∞:
- **–ü—Ä–æ–¥—É–∫—Ç—ã** ‚Äî —Å–ø–∏—Å–æ–∫ –æ–±—ã—á–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å –ø–æ–∏—Å–∫–æ–º
- **–ü–ª–∞–Ω** ‚Äî –Ω–µ–¥–µ–ª—å–Ω—ã–π –ø–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è (7 –¥–Ω–µ–π √ó 4 —Å–ª–æ—Ç–∞: –∑–∞–≤—Ç—Ä–∞–∫, –æ–±–µ–¥, —É–∂–∏–Ω, –ø–µ—Ä–µ–∫—É—Å)

### –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

**–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç:**
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ü—Ä–æ–¥—É–∫—Ç—ã**
2. –ù–∞–∂–º–∏—Ç–µ ‚ûï
3. –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ç–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é), –º–∞–∫—Ä–æ—Å—ã –Ω–∞ 100–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

**–°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è:**
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ü–ª–∞–Ω**
2. –ù–∞–∂–º–∏—Ç–µ **–°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω** (–∏–ª–∏ **‚ãØ ‚Üí –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å** –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ)
3. –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∞
4. –î–æ–±–∞–≤—å—Ç–µ –±–ª—é–¥–∞ —á–µ—Ä–µ–∑ **+ –î–æ–±–∞–≤–∏—Ç—å –±–ª—é–¥–æ**:
   - –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–Ω—å (0-6) –∏ –ø—Ä–∏—ë–º –ø–∏—â–∏ (–∑–∞–≤—Ç—Ä–∞–∫/–æ–±–µ–¥/—É–∂–∏–Ω/–ø–µ—Ä–µ–∫—É—Å)
   - –£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –±–ª—é–¥–∞
   - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∑–∞–º–µ—Ç–∫–∏ –∏ –º–∞–∫—Ä–æ—Å—ã
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ (–º–∞–∫—Å–∏–º—É–º 28 –±–ª—é–¥ = 7 –¥–Ω–µ–π √ó 4 —Å–ª–æ—Ç–∞)

**–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ Home:**
–ö–∞—Ä—Ç–æ—á–∫–∞ **–ü–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è —Å–µ–≥–æ–¥–Ω—è** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –ù–∞–∑–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∞
- –ë–ª—é–¥–∞ –Ω–∞ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏
- –ö–Ω–æ–ø–∫–∞ **–û—Ç–∫—Ä—ã—Ç—å** –≤–µ–¥—ë—Ç –≤ —Ä–∞–∑–¥–µ–ª –ü–∏—Ç–∞–Ω–∏–µ

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ AI:**
–ù–∞–ø–∏—à–∏—Ç–µ –≤ —á–∞—Ç–µ: *"–°–æ—Å—Ç–∞–≤—å –ø–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è –Ω–∞ –Ω–µ–¥–µ–ª—é"*
–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –ø–ª–∞–Ω ‚Üí –Ω–∞–∂–º–∏—Ç–µ **–ü—Ä–∏–º–µ–Ω–∏—Ç—å** ‚Üí –ø–ª–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω.

### API –ø—Ä–∏–º–µ—Ä—ã

```bash
# –°–æ–∑–¥–∞—Ç—å –¥–æ–±–∞–≤–∫—É
jq -n --arg pid "$PROFILE_ID" '{
  profile_id: $pid,
  name: "–í–∏—Ç–∞–º–∏–Ω D3",
  notes: "2000 IU –µ–∂–µ–¥–Ω–µ–≤–Ω–æ",
  components: [{
    nutrient_key: "vitamin_d",
    hk_identifier: "dietaryVitaminD",
    amount: 2000,
    unit: "IU"
  }]
}' | curl -X POST http://localhost:8080/v1/supplements \
  -H 'Content-Type: application/json' --data-binary @- | jq .

# –°–ø–∏—Å–æ–∫ –¥–æ–±–∞–≤–æ–∫
curl "http://localhost:8080/v1/supplements?profile_id=$PROFILE_ID" | jq .

# –î–æ–±–∞–≤–∏—Ç—å –≤–æ–¥—É
jq -n --arg pid "$PROFILE_ID" '{
  profile_id: $pid,
  taken_at: (now | todate),
  amount_ml: 250
}' | curl -X POST http://localhost:8080/v1/intakes/water \
  -H 'Content-Type: application/json' --data-binary @- | jq .

# –ü–æ–ª—É—á–∏—Ç—å intakes –∑–∞ –¥–µ–Ω—å
curl "http://localhost:8080/v1/intakes/daily?profile_id=$PROFILE_ID&date=2026-02-13" | jq .

# –û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–∏—ë–º –¥–æ–±–∞–≤–∫–∏ (–∑–∞–º–µ–Ω–∏ SUPPLEMENT_ID)
jq -n --arg pid "$PROFILE_ID" --arg sid "$SUPPLEMENT_ID" '{
  profile_id: $pid,
  supplement_id: $sid,
  date: "2026-02-13",
  status: "taken"
}' | curl -X POST http://localhost:8080/v1/intakes/supplements \
  -H 'Content-Type: application/json' --data-binary @- | jq .

# –°–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–æ–±–∞–≤–∫–∏
jq -n --arg pid "$PROFILE_ID" --arg sid "$SUPPLEMENT_ID" '{
  profile_id: $pid,
  supplement_id: $sid,
  time_minutes: 720,
  days_mask: 127,
  is_enabled: true
}' | curl -X POST http://localhost:8080/v1/schedules/supplements \
  -H 'Content-Type: application/json' --data-binary @- | jq .

# –°–ø–∏—Å–æ–∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π
curl "http://localhost:8080/v1/schedules/supplements?profile_id=$PROFILE_ID" | jq .

# –ó–∞–º–µ–Ω–∏—Ç—å –≤–µ—Å—å –Ω–∞–±–æ—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π (replace=true)
jq -n --arg pid "$PROFILE_ID" --arg sid "$SUPPLEMENT_ID" '{
  profile_id: $pid,
  replace: true,
  schedules: [
    {supplement_id:$sid, time_minutes:720, days_mask:127, is_enabled:true}
  ]
}' | curl -X PUT http://localhost:8080/v1/schedules/supplements/replace \
  -H 'Content-Type: application/json' --data-binary @- | jq .
```

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ MVP: –º–∞–∫—Å–∏–º—É–º `20` —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å.

### iOS: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. **–û—Ç–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥–∫—É "–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"** ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ "–ü—Ä–∏–µ–º"
2. **–í–æ–¥–∞**:
   - –ö–Ω–æ–ø–∫–∏ –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: +250 –º–ª
   - "–î—Ä—É–≥–æ–µ..." –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
   - –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ Apple Health (–µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ)
3. **–î–æ–±–∞–≤–∫–∏**:
   - –ù–∞–∂–∞—Ç—å "+" –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –¥–æ–±–∞–≤–∫–∏
   - –û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–∏—ë–º: ‚úì (–ø—Ä–∏–Ω—è–ª) / √ó (–ø—Ä–æ–ø—É—Å—Ç–∏–ª) / ‚Äî (–Ω–µ –æ—Ç–º–µ—á–µ–Ω–æ)
4. **Feed/day**: —Å–≤–æ–¥–∫–∞ –∑–∞ –¥–µ–Ω—å –≤–∫–ª—é—á–∞–µ—Ç `intakes` —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –≤–æ–¥—ã –∏ –ø—Ä–∏–Ω—è—Ç—ã—Ö –¥–æ–±–∞–≤–æ–∫

### HealthKit write-back

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤–æ–¥—ã —á–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
- –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ HealthKit (`dietaryWater`)
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–æ–±–∞–≤–æ–∫ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω `hk_identifier` (–≤–∏—Ç–∞–º–∏–Ω—ã, –º–∏–Ω–µ—Ä–∞–ª—ã)

–ï—Å–ª–∏ HealthKit –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –æ—Ç–∫–∞–∑–∞–Ω–æ –≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏ ‚Äî –æ–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –±–µ–∑ –∑–∞–ø–∏—Å–∏ –≤ Health.

## –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã API

–ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π —Ñ–∞–π–ª: `contracts/openapi.yaml` (v0.9.0) ‚Äî —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (Profiles, Metrics, Checkins, Feed, Reports, Sources, Inbox, Intakes).

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: —Ñ–∞–π–ª `contracts/openapi-feed-checkins.yaml` ‚Äî —É—Å—Ç–∞—Ä–µ–≤—à–∏–π (deprecated), –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–æ –≤ `contracts/openapi.yaml`.

**v0.8.0 (—Ç–µ–∫—É—â–∞—è)**: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è HealthKit ‚Äî Sleep (stages), Workouts, Nutrition (kcal, protein, fat, carbs, calcium), Activity (active energy, distance, exercise minutes, stand hours), Wrist Temperature.

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**:
- `GET /healthz` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞
- `POST /v1/auth/dev` ‚Äî DEV login, –≤—ã–¥–∞—á–∞ JWT –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- `POST /v1/auth/siwa` ‚Äî Sign in with Apple (SIWA), –≤—ã–¥–∞—á–∞ JWT
- `POST /v1/auth/email/request` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ OTP –∫–æ–¥–∞ –Ω–∞ email
- `POST /v1/auth/email/verify` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ OTP –∏ –≤—ã–¥–∞—á–∞ JWT
- `GET /v1/settings` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π/–ø–æ—Ä–æ–≥–æ–≤
- `PUT /v1/settings` ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π/–ø–æ—Ä–æ–≥–æ–≤
- `GET /v1/profiles` ‚Äî —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—Ñ–∏–ª–µ–π (owner + guests)
- `POST /v1/profiles` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ guest –ø—Ä–æ—Ñ–∏–ª—è
- `PATCH /v1/profiles/{id}` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –ø—Ä–æ—Ñ–∏–ª—è
- `DELETE /v1/profiles/{id}` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ guest –ø—Ä–æ—Ñ–∏–ª—è
- `POST /v1/sync/batch` ‚Äî –±–∞—Ç—á–µ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ (daily/hourly/sleep/workouts)
- `GET /v1/metrics/daily?profile_id=&from=&to=` ‚Äî –¥–Ω–µ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥
- `GET /v1/metrics/hourly?profile_id=&date=&metric=` ‚Äî —á–∞—Å–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (steps –∏–ª–∏ hr)
- `GET /v1/checkins?profile_id=&from=&to=` ‚Äî —Å–ø–∏—Å–æ–∫ —á–µ–∫–∏–Ω–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥
- `POST /v1/checkins` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ–∫–∏–Ω–∞ (UPSERT –ø–æ profile_id, date, type)
- `DELETE /v1/checkins/{id}` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ —á–µ–∫–∏–Ω–∞
- `GET /v1/feed/day?profile_id=&date=` ‚Äî —Å–≤–æ–¥–∫–∞ –¥–Ω—è (daily metrics + checkins)
- `POST /v1/reports` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞ (PDF/CSV)
- `GET /v1/reports?profile_id=` ‚Äî —Å–ø–∏—Å–æ–∫ –æ—Ç—á—ë—Ç–æ–≤
- `GET /v1/reports/{id}/download` ‚Äî —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–∞
- `DELETE /v1/reports/{id}` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –æ—Ç—á—ë—Ç–∞
- `POST /v1/sources` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ link/note source
- `POST /v1/sources/image` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ (multipart)
- `GET /v1/sources?profile_id=&checkin_id=` ‚Äî —Å–ø–∏—Å–æ–∫ sources
- `GET /v1/sources/{id}/download` ‚Äî —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- `DELETE /v1/sources/{id}` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ source
- `GET /v1/inbox?profile_id=` ‚Äî —Å–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `GET /v1/inbox/unread-count?profile_id=` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
- `POST /v1/inbox/mark-read` ‚Äî –æ—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏
- `POST /v1/inbox/mark-all-read` ‚Äî –æ—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏
- `POST /v1/inbox/generate` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∑–∞ –¥–µ–Ω—å
- `POST /v1/supplements` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ–±–∞–≤–∫–∏
- `GET /v1/supplements?profile_id=` ‚Äî —Å–ø–∏—Å–æ–∫ –¥–æ–±–∞–≤–æ–∫
- `PATCH /v1/supplements/{id}` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–±–∞–≤–∫–∏
- `DELETE /v1/supplements/{id}` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –¥–æ–±–∞–≤–∫–∏
- `POST /v1/intakes/water` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–¥—ã
- `GET /v1/intakes/daily?profile_id=&date=` ‚Äî –ø—Ä–∏—ë–º—ã –∑–∞ –¥–µ–Ω—å
- `POST /v1/intakes/supplements` ‚Äî –æ—Ç–º–µ—Ç–∫–∞ –ø—Ä–∏—ë–º–∞ –¥–æ–±–∞–≤–∫–∏
- `GET /v1/chat/messages?profile_id=&limit=&before=` ‚Äî –∏—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞
- `POST /v1/chat/messages` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É (—Å proposals –≤ –æ—Ç–≤–µ—Ç–µ)
- `GET /v1/ai/proposals?profile_id=&status=&limit=` ‚Äî —Å–ø–∏—Å–æ–∫ AI proposals
- `POST /v1/ai/proposals/{id}/apply` ‚Äî –ø—Ä–∏–º–µ–Ω–∏—Ç—å proposal (`settings_update` –∏ `vitamins_schedule`)
- `POST /v1/ai/proposals/{id}/reject` ‚Äî –æ—Ç–∫–ª–æ–Ω–∏—Ç—å proposal
- `GET /v1/schedules/supplements?profile_id=` ‚Äî —Å–ø–∏—Å–æ–∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π –¥–æ–±–∞–≤–æ–∫
- `POST /v1/schedules/supplements` ‚Äî —Å–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
- `PUT /v1/schedules/supplements/replace` ‚Äî –∞—Ç–æ–º–∞—Ä–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞–±–æ—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π
- `DELETE /v1/schedules/supplements/{id}` ‚Äî —É–¥–∞–ª–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ

## Authentication (DEV + SIWA + Email OTP + JWT)

–ë–∞–∑–æ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å JWT –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```bash
# Auth
AUTH_MODE=none              # none | dev | siwa
AUTH_REQUIRED=0             # 0 = optional token, 1 = require Bearer for /v1/*
EMAIL_AUTH_ENABLED=0        # 0 | 1
JWT_SECRET=change_me        # –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ JWT (HS256)
OTP_SECRET=                 # optional, fallback=JWT_SECRET
JWT_ISSUER=health-hub
JWT_TTL_MINUTES=10080       # 7 –¥–Ω–µ–π
OTP_TTL_SECONDS=600
OTP_MAX_ATTEMPTS=5
OTP_RESEND_MIN_SECONDS=60
OTP_MAX_SEND_PER_HOUR=5
EMAIL_SENDER_MODE=local     # local | smtp
OTP_DEBUG_RETURN_CODE=0     # 1 only for APP_ENV=local
SMTP_HOST=
SMTP_PORT=587
SMTP_USERNAME=
SMTP_PASSWORD=
SMTP_FROM="HealthHub <no-reply@yourdomain.com>"
SMTP_USE_TLS=1
APPLE_BUNDLE_ID=
APPLE_ISS=https://appleid.apple.com
APPLE_JWKS_URL=https://appleid.apple.com/auth/keys
APPLE_SUB_PREFIX=apple:
```

### –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

#### AUTH_MODE=none (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø—É–±–ª–∏—á–Ω—ã–µ
- –¢–æ–∫–µ–Ω –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
- –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞–Ω –≤ `Authorization`, —Å–µ—Ä–≤–µ—Ä –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –µ–≥–æ

```bash
cd server
AUTH_MODE=none JWT_SECRET=change_me go run cmd/api/main.go
```

#### AUTH_MODE=dev
- –î–ª—è iOS DEV login (`POST /v1/auth/dev`)
- –î–ª—è —Å—Ç—Ä–æ–≥–æ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤–∫–ª—é—á–∏—Ç—å `AUTH_REQUIRED=1`

```bash
cd server
AUTH_MODE=dev \
AUTH_REQUIRED=1 \
JWT_SECRET="your-secret-key-change-in-production" \
go run cmd/api/main.go
```

#### AUTH_MODE=siwa
- –î–ª—è Sign in with Apple (`POST /v1/auth/siwa`)
- –ü—Ä–∏ `AUTH_REQUIRED=1` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å `APPLE_BUNDLE_ID`

```bash
cd server
AUTH_MODE=siwa \
AUTH_REQUIRED=1 \
JWT_SECRET="your-secret-key-change-in-production" \
APPLE_BUNDLE_ID="com.example.HealthHub" \
go run cmd/api/main.go
```

### Local Auth (dev)

```bash
TOKEN=$(curl -s -X POST http://localhost:8080/v1/auth/dev | jq -r '.access_token')

curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:8080/v1/profiles | jq .
```

### Local Auth (Email OTP, debug)

```bash
EMAIL=user@example.com

REQUEST_JSON=$(cat <<JSON
{"email":"$EMAIL"}
JSON
)

REQUEST_RESP=$(curl -s http://localhost:8080/v1/auth/email/request \
  -H "Content-Type: application/json" \
  -d "$REQUEST_JSON")

CODE=$(echo "$REQUEST_RESP" | jq -r '.debug_code')

VERIFY_JSON=$(cat <<JSON
{"email":"$EMAIL","code":"$CODE"}
JSON
)

TOKEN=$(curl -s http://localhost:8080/v1/auth/email/verify \
  -H "Content-Type: application/json" \
  -d "$VERIFY_JSON" | jq -r '.access_token')

curl -s http://localhost:8080/v1/profiles \
  -H "Authorization: Bearer $TOKEN" | jq .
```

### Local Auth (SIWA)

1. iOS –ø–æ–ª—É—á–∞–µ—Ç `identity_token` –∏–∑ `SignInWithAppleButton`.
2. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `POST /v1/auth/siwa` —Å `identity_token`.
3. –°–µ—Ä–≤–µ—Ä –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç Apple token —á–µ—Ä–µ–∑ JWKS (`APPLE_JWKS_URL`) –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `iss/aud/exp`.
4. –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞—à JWT (`HS256`) —Å `sub=apple:<apple-sub>`.
5. –ö–ª–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ—Ç Bearer token –¥–ª—è –≤—Å–µ—Ö `/v1/*`.

### Email OTP auth

- `POST /v1/auth/email/request` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `{ "email": "user@example.com" }`.
- `POST /v1/auth/email/verify` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `{ "email": "user@example.com", "code": "123456" }` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT.
- `sub` –≤ –Ω–∞—à–µ–º —Ç–æ–∫–µ–Ω–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ `email:<normalized-email>`.

–õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º (–±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏):

```bash
cd server
AUTH_MODE=dev \
AUTH_REQUIRED=1 \
EMAIL_AUTH_ENABLED=1 \
EMAIL_SENDER_MODE=local \
OTP_DEBUG_RETURN_CODE=1 \
APP_ENV=local \
JWT_SECRET=dev_secret \
go run ./cmd/api
```

SMTP —Ä–µ–∂–∏–º:

```bash
cd server
AUTH_MODE=siwa \
AUTH_REQUIRED=1 \
EMAIL_AUTH_ENABLED=1 \
EMAIL_SENDER_MODE=smtp \
SMTP_HOST=smtp.your-provider.com \
SMTP_PORT=587 \
SMTP_USERNAME=your_user \
SMTP_PASSWORD=your_password \
SMTP_FROM="HealthHub <no-reply@yourdomain.com>" \
SMTP_USE_TLS=1 \
JWT_SECRET=prod_secret \
go run ./cmd/api
```

### –õ–æ–≥–∏–∫–∞ –≤ —ç—Ç–æ–º —à–∞–≥–µ

1. `POST /v1/auth/dev` –≤—ã–¥–∞–µ—Ç JWT c `sub=dev-user` –∏ TTL –æ–∫–æ–ª–æ 30 –¥–Ω–µ–π.
2. `POST /v1/auth/siwa` –≤—ã–¥–∞–µ—Ç JWT c `sub=apple:<apple-sub>` –∏ TTL –æ–∫–æ–ª–æ 30 –¥–Ω–µ–π.
3. `POST /v1/auth/email/verify` –≤—ã–¥–∞–µ—Ç JWT c `sub=email:<normalized-email>` –∏ TTL –æ–∫–æ–ª–æ 30 –¥–Ω–µ–π.
4. –ü—Ä–∏ `AUTH_REQUIRED=1` –≤—Å–µ `/v1/*` (–∫—Ä–æ–º–µ `/v1/auth/*`) —Ç—Ä–µ–±—É—é—Ç Bearer token.
5. –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π Bearer token –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `401`.

### Security Notes

- `JWT_SECRET` ‚Äî –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–ª–æ–∂–Ω—ã–º (–º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞) –≤ production
- Bearer token –≤ Authorization header
- Ownership enforcement: 404 (–Ω–µ 403) –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ ‚Äî –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π
- Apple token verification: RSA signature + aud/iss/exp validation

### Production Auth (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è)

–í production –∏—Å–ø–æ–ª—å–∑—É–µ–º **Email OTP** –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–± –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:

```
AUTH_MODE=dev  AUTH_REQUIRED=1  EMAIL_AUTH_ENABLED=1  EMAIL_SENDER_MODE=smtp
```

- `AUTH_MODE=dev` –≤–∫–ª—é—á–∞–µ—Ç JWT-–≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ –≤—Å–µ auth-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (Email OTP, dev token)
- `AUTH_REQUIRED=1` —Ç—Ä–µ–±—É–µ—Ç Bearer token –¥–ª—è –≤—Å–µ—Ö `/v1/*` (–∫—Ä–æ–º–µ `/v1/auth/*`)
- `EMAIL_SENDER_MODE=smtp` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç OTP-–∫–æ–¥—ã —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç–æ—è—â–∏–π SMTP (—Å–º. `SMTP_*` vars)
- SIWA –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –ø–æ–∑–∂–µ (`AUTH_MODE=siwa` + `APPLE_BUNDLE_ID`), –Ω–µ –ª–æ–º–∞—è Email OTP flow
- –í local mode (`EMAIL_SENDER_MODE=local`) OTP-–∫–æ–¥ –ø—Ä–æ—Å—Ç–æ –ø–µ—á–∞—Ç–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞ ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## AI mode

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é backend —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ `AI_MODE=mock` –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π.

```bash
AI_MODE=mock
AI_MAX_OUTPUT_TOKENS=600
AI_TEMPERATURE=0.3
AI_TIMEOUT_SECONDS=20
```

–î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞:

```bash
AI_MODE=openai
OPENAI_API_KEY=your_openai_key
OPENAI_MODEL=gpt-4.1-mini
```

–ï—Å–ª–∏ `AI_MODE=openai` –∏ –∫–ª—é—á –Ω–µ –∑–∞–¥–∞–Ω, —Å–µ—Ä–≤–µ—Ä –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Å FATAL –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ.

–ü—Ä–∏–º–µ—Ä `curl` –¥–ª—è —á–∞—Ç–∞ –≤ mock —Ä–µ–∂–∏–º–µ:

```bash
TOKEN="your_access_token"
PROFILE_ID="your_profile_id"

CHAT_JSON=$(cat <<JSON
{
  "profile_id": "$PROFILE_ID",
  "content": "–ü—Ä–æ–≤–µ—Ä—å –º–æ–∏ –ø–æ—Ä–æ–≥–∏ —à–∞–≥–æ–≤ –∏ —Å–Ω–∞"
}
JSON
)

curl -s -X POST http://localhost:8080/v1/chat/messages \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d "$CHAT_JSON" | jq .
```

–ü—Ä–∏–º–µ—Ä `curl` –¥–ª—è proposals (apply/reject):

```bash
TOKEN="your_access_token"
PROFILE_ID="your_profile_id"

# –°–ø–∏—Å–æ–∫ pending proposals
curl -s "http://localhost:8080/v1/ai/proposals?profile_id=$PROFILE_ID&status=pending&limit=20" \
  -H "Authorization: Bearer $TOKEN" | jq .

# –ë–µ—Ä—ë–º –ø–µ—Ä–≤—ã–π proposal id
PROPOSAL_ID=$(curl -s "http://localhost:8080/v1/ai/proposals?profile_id=$PROFILE_ID&status=pending&limit=20" \
  -H "Authorization: Bearer $TOKEN" | jq -r '.proposals[0].id')

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å proposal (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è settings_update –∏ vitamins_schedule)
curl -s -X POST "http://localhost:8080/v1/ai/proposals/$PROPOSAL_ID/apply" \
  -H "Authorization: Bearer $TOKEN" | jq .

# –û—Ç–∫–ª–æ–Ω–∏—Ç—å proposal
curl -s -X POST "http://localhost:8080/v1/ai/proposals/$PROPOSAL_ID/reject" \
  -H "Authorization: Bearer $TOKEN" | jq .
```

–ü—Ä–∏–º–µ—Ä flow `chat -> vitamins_schedule proposal -> apply`:

```bash
TOKEN="your_access_token"
PROFILE_ID="your_profile_id"

CHAT_JSON=$(cat <<JSON
{
  "profile_id": "$PROFILE_ID",
  "content": "–°–¥–µ–ª–∞–π —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤–∏—Ç–∞–º–∏–Ω–æ–≤: –º–∞–≥–Ω–∏–π –≤ 12:00 –µ–∂–µ–¥–Ω–µ–≤–Ω–æ"
}
JSON
)

# 1) –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (mock/openai –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å vitamins_schedule proposal)
curl -s -X POST http://localhost:8080/v1/chat/messages \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d "$CHAT_JSON" | jq .

# 2) –ë–µ—Ä—ë–º pending proposal –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º
PROPOSAL_ID=$(curl -s "http://localhost:8080/v1/ai/proposals?profile_id=$PROFILE_ID&status=pending&limit=20" \
  -H "Authorization: Bearer $TOKEN" | jq -r '.proposals[] | select(.kind=="vitamins_schedule") | .id' | head -n1)

curl -s -X POST "http://localhost:8080/v1/ai/proposals/$PROPOSAL_ID/apply" \
  -H "Authorization: Bearer $TOKEN" | jq .

# 3) –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
curl -s "http://localhost:8080/v1/schedules/supplements?profile_id=$PROFILE_ID" \
  -H "Authorization: Bearer $TOKEN" | jq .
```

## User Settings

–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`owner_user_id = JWT sub`) –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è:
- –ø–æ—Ä–æ–≥–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (`min_sleep_minutes`, `min_steps`, `min_active_energy_kcal`)
- quiet hours (`quiet_start_minutes`, `quiet_end_minutes`, `time_zone`)
- —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (`morning_checkin_time_minutes`, `evening_checkin_time_minutes`, `vitamins_time_minutes`)
- –ª–∏–º–∏—Ç–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (`notifications_max_per_day`)

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â—ë –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- `GET /v1/settings` –≤–µ—Ä–Ω—ë—Ç `is_default=true`
- —Å–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç fallback –∏–∑ env (`NOTIFICATIONS_MAX_PER_DAY`, `DEFAULT_*`)

–ü—Ä–∏–º–µ—Ä `GET /v1/settings`:

```bash
TOKEN="your_access_token"

curl -s http://localhost:8080/v1/settings \
  -H "Authorization: Bearer $TOKEN" | jq .
```

–ü—Ä–∏–º–µ—Ä `PUT /v1/settings`:

```bash
TOKEN="your_access_token"

SETTINGS_JSON=$(cat <<JSON
{
  "time_zone": "Europe/Moscow",
  "quiet_start_minutes": 1380,
  "quiet_end_minutes": 480,
  "notifications_max_per_day": 3,
  "min_sleep_minutes": 420,
  "min_steps": 8000,
  "min_active_energy_kcal": 300,
  "morning_checkin_time_minutes": 540,
  "evening_checkin_time_minutes": 1260,
  "vitamins_time_minutes": 720
}
JSON
)

curl -s -X PUT http://localhost:8080/v1/settings \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d "$SETTINGS_JSON" | jq .
```

## S3 —Ä–µ–∂–∏–º (Yandex Object Storage)

Blob-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è attachments/sources –∏ reports –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ä–µ–∂–∏–º—ã `local | s3 | auto`.

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å S3

1. **–°–æ–∑–¥–∞–π—Ç–µ –±–∞–∫–µ—Ç –≤ Yandex Object Storage** (–∏–ª–∏ –¥—Ä—É–≥–æ–º S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)

2. **–ü–æ–ª—É—á–∏—Ç–µ credentials**: Access Key ID –∏ Secret Access Key

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**:

```bash
# –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã
BLOB_MODE=auto               # local | s3 | auto (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º auto)
REPORTS_MODE=                # optional override –¥–ª—è reports

# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è S3
S3_ENDPOINT=https://storage.yandexcloud.net
S3_REGION=ru-central1        # –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û (–Ω–µ –ø—É—Å—Ç–æ–π)
S3_BUCKET=your-bucket-name
S3_ACCESS_KEY_ID=YCAxxxxxxxxxxxxx
S3_SECRET_ACCESS_KEY=YCMxxxxxxxxxxxxxxxxxxxxxx
S3_PUBLIC_BASE_URL=https://storage.yandexcloud.net/your-bucket-name  # –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
S3_PRESIGN_TTL_SECONDS=900   # –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ presigned URLs (default: 900)
S3_PREFER_PUBLIC_URL=0       # 0=presigned URLs, 1=public URLs (—Ç—Ä–µ–±—É–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π bucket)
```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä**:

```bash
cd server
go run ./cmd/api
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –ª–æ–≥–∞–º

–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä –≤—ã–≤–æ–¥–∏—Ç —á—ë—Ç–∫–∏–µ –ª–æ–≥–∏ –æ —Ä–µ–∂–∏–º–µ blob storage:

```
INFO blob: initializing sources store (BLOB_MODE=auto)
INFO blob.s3: code=s3_ready endpoint=https://storage.yandexcloud.net region=ru-central1 ...
INFO blob: sources blob mode: s3 (auto, configured)
INFO blob: reports blob mode: s3 (same as sources)
```

–ï—Å–ª–∏ S3 –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (mode=auto):
```
INFO blob.s3: code=s3_not_configured not configured (all empty)
INFO blob: sources blob mode: local (auto, S3 not configured)
```

–ï—Å–ª–∏ –∫–æ–Ω—Ñ–∏–≥ –Ω–µ–ø–æ–ª–Ω—ã–π (mode=s3):
```
FATAL blob.s3: code=s3_config_incomplete missing=[S3_REGION S3_PUBLIC_BASE_URL]
FATAL: BLOB_MODE=s3 requested but missing required config: S3_REGION, S3_PUBLIC_BASE_URL
```

### –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

#### `BLOB_MODE=local`
–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç local/memory storage. S3 –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.

#### `BLOB_MODE=auto` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- –ï—Å–ª–∏ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ S3 –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–¥–∞–Ω—ã ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç S3
- –ï—Å–ª–∏ –∫–æ–Ω—Ñ–∏–≥ –Ω–µ–ø–æ–ª–Ω—ã–π ‚Üí fallback –Ω–∞ local + –≤—ã–≤–æ–¥–∏—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

#### `BLOB_MODE=s3`
- –ï—Å–ª–∏ –∫–æ–Ω—Ñ–∏–≥ –Ω–µ–ø–æ–ª–Ω—ã–π ‚Üí —Å–µ—Ä–≤–µ—Ä **FATAL** —Å –ø–æ–Ω—è—Ç–Ω–æ–π –æ—à–∏–±–∫–æ–π
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ, –∫–æ–≥–¥–∞ S3 –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω

#### `REPORTS_MODE`
–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π override —Ç–æ–ª—å–∫–æ –¥–ª—è reports. –ï—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω, –Ω–∞—Å–ª–µ–¥—É–µ—Ç `BLOB_MODE`.

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

–î–ª—è —Ä–∞–±–æ—Ç—ã S3 —Ä–µ–∂–∏–º–∞ —Ç—Ä–µ–±—É—é—Ç—Å—è **–í–°–ï** —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `S3_ENDPOINT` ‚Äî URL —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- `S3_REGION` ‚Äî —Ä–µ–≥–∏–æ–Ω (–Ω–µ –ø—É—Å—Ç–æ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä `ru-central1`)
- `S3_BUCKET` ‚Äî –∏–º—è –±–∞–∫–µ—Ç–∞
- `S3_ACCESS_KEY_ID` ‚Äî –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞
- `S3_SECRET_ACCESS_KEY` ‚Äî —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á
- `S3_PUBLIC_BASE_URL` ‚Äî –±–∞–∑–æ–≤—ã–π –ø—É–±–ª–∏—á–Ω—ã–π URL (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –≤ —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ)

### Public URLs vs Presigned URLs

**–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é (S3_PREFER_PUBLIC_URL=0)**: –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è presigned URLs
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ: –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º —Å—Ä–æ–∫–æ–º –¥–µ–π—Å—Ç–≤–∏—è
- –†–∞–±–æ—Ç–∞–µ—Ç —Å –ø—Ä–∏–≤–∞—Ç–Ω—ã–º–∏ –±–∞–∫–µ—Ç–∞–º–∏
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

**S3_PREFER_PUBLIC_URL=1**: –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—É–±–ª–∏—á–Ω—ã–µ URLs
- –¢—Ä–µ–±—É–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π –±–∞–∫–µ—Ç –∏–ª–∏ CDN
- –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –≤–∏–¥–∞ `https://storage.yandexcloud.net/bucket/key`
- –ï—Å–ª–∏ –±–∞–∫–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–π ‚Üí –ø–æ–ª—É—á–∏—Ç–µ 403 Forbidden

### Troubleshooting

**–û—à–∏–±–∫–∞: 403 Forbidden –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏**
- –ï—Å–ª–∏ `S3_PREFER_PUBLIC_URL=1`: —Å–¥–µ–ª–∞–π—Ç–µ –±–∞–∫–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–º –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ CDN
- –ï—Å–ª–∏ `S3_PREFER_PUBLIC_URL=0`: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ Access Key –∏ Secret Key

**–û—à–∏–±–∫–∞: "missing required config"**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –í–°–ï –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–¥–∞–Ω—ã
- `S3_REGION` –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É—Å—Ç—ã–º
- `S3_PUBLIC_BASE_URL` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω (–¥–∞–∂–µ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ presigned URLs)

**–°–º–µ—à–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º (sources local, reports S3)**
```bash
BLOB_MODE=local
REPORTS_MODE=s3
# ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ S3 –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
```

### –ü—Ä–∏–º–µ—Ä –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

```bash
cd server
BLOB_MODE=auto \
S3_ENDPOINT=https://storage.yandexcloud.net \
S3_REGION=ru-central1 \
S3_BUCKET=health-hub-prod \
S3_ACCESS_KEY_ID=YCAxxxxx \
S3_SECRET_ACCESS_KEY=YCMxxxxx \
S3_PUBLIC_BASE_URL=https://cdn.yourdomain.com \
S3_PRESIGN_TTL_SECONDS=3600 \
go run ./cmd/api
```

## E2E Smoke Tests

Smoke test CLI –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ–π —Ü–µ–ø–æ—á–∫–∏: profiles ‚Üí sync ‚Üí feed ‚Üí reports ‚Üí sources.

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
cd server

# Local mode (–±–µ–∑ auth)
go run ./cmd/smoke

# –° –∫–∞—Å—Ç–æ–º–Ω—ã–º API URL
API_BASE_URL=http://localhost:8080 go run ./cmd/smoke

# –° —Ç–æ–∫–µ–Ω–æ–º (–µ—Å–ª–∏ AUTH_REQUIRED=1)
SMOKE_TOKEN=your_jwt_token go run ./cmd/smoke

# –° –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º profile_id (–∏–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è owner profile)
SMOKE_PROFILE_ID=uuid-here go run ./cmd/smoke
```

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è

1. **Healthz** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
2. **Get Profile ID** ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ owner profile –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SMOKE_PROFILE_ID
3. **Sync Batch** ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ daily metrics
4. **Create Checkin** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ morning checkin
5. **Get Feed Day** ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –ª–µ–Ω—Ç—ã –∑–∞ –¥–µ–Ω—å
6. **Create Report (PDF)** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –æ—Ç—á–µ—Ç–∞
7. **List Reports** ‚Äî —Å–ø–∏—Å–æ–∫ –æ—Ç—á–µ—Ç–æ–≤
8. **Download Report** ‚Äî —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π redirect (local/S3)
9. **Upload Source (Image)** ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ PNG
10. **List Sources** ‚Äî —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
11. **Download Source** ‚Äî —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π redirect (local/S3)
12. **Delete Source** ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
13. **Delete Report** ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞

### Environment Variables

- `API_BASE_URL` ‚Äî –±–∞–∑–æ–≤—ã–π URL API (default: `http://localhost:8080`)
- `SMOKE_TOKEN` ‚Äî Bearer —Ç–æ–∫–µ–Ω (optional, –¥–ª—è —Ä–µ–∂–∏–º–∞ —Å auth)
- `SMOKE_PROFILE_ID` ‚Äî ID –ø—Ä–æ—Ñ–∏–ª—è (optional, –∏–Ω–∞—á–µ –±–µ—Ä–µ—Ç—Å—è owner)

### –ü—Ä–∏–º–µ—Ä—ã

**Local mode (BLOB_MODE=local, AUTH_REQUIRED=0):**
```bash
cd server
go run ./cmd/api &
sleep 2
go run ./cmd/smoke
# –û–∂–∏–¥–∞–µ–º: ‚úÖ ALL SMOKE TESTS PASSED
```

**S3 mode (BLOB_MODE=auto):**
```bash
cd server
BLOB_MODE=auto \
S3_ENDPOINT=https://storage.yandexcloud.net \
S3_REGION=ru-central1 \
S3_BUCKET=your-bucket \
S3_ACCESS_KEY_ID=YCAxxxxx \
S3_SECRET_ACCESS_KEY=YCMxxxxx \
S3_PUBLIC_BASE_URL=https://storage.yandexcloud.net/your-bucket \
go run ./cmd/api &

sleep 2
go run ./cmd/smoke
# –ü—Ä–æ–≤–µ—Ä—è–µ—Ç download —á–µ—Ä–µ–∑ S3 redirects
```

**–° auth:**
```bash
# –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ dev auth
TOKEN=$(curl -s -X POST http://localhost:8080/v1/auth/dev \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com"}' | jq -r .token)

SMOKE_TOKEN=$TOKEN go run ./cmd/smoke
```

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

Smoke test –≤—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É:
```
[8/13] Download Report... ‚ùå FAILED
  Error: redirect failed: status=403 body=...
```

**403 –ø—Ä–∏ download (S3 mode):**
- –ï—Å–ª–∏ `S3_PREFER_PUBLIC_URL=1`: —Å–¥–µ–ª–∞–π—Ç–µ bucket –ø—É–±–ª–∏—á–Ω—ã–º
- –ï—Å–ª–∏ `S3_PREFER_PUBLIC_URL=0`: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ credentials

**401 Unauthorized:**
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `SMOKE_TOKEN` –µ—Å–ª–∏ `AUTH_REQUIRED=1`
- –ò–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç–µ auth: `AUTH_REQUIRED=0`

**Report/Source size 0:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏/upload

## Workout Plans (MVP)

**–û–ø–∏—Å–∞–Ω–∏–µ**: –°–∏—Å—Ç–µ–º–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è, –æ—Ç–º–µ—Ç–∫–∞–º–∏ –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫** ‚Äî –¥–æ 30 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–∏–ø–∞, –≤—Ä–µ–º–µ–Ω–∏, –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏
- ‚úÖ **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏** ‚Äî –±–∏—Ç–æ–≤–∞—è –º–∞—Å–∫–∞ –¥–ª—è –≥–∏–±–∫–æ–≥–æ –≤—ã–±–æ—Ä–∞ –¥–Ω–µ–π (–ø–Ω-–≤—Å)
- ‚úÖ **–û—Ç–º–µ—Ç–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è** ‚Äî done/skipped –¥–ª—è –∫–∞–∂–¥–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
- ‚úÖ **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö —Å —É—á–µ—Ç–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ **AI Proposals** ‚Äî –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –º–æ–∂–µ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –ø–ª–∞–Ω—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ —á–µ—Ä–µ–∑ —á–∞—Ç
- ‚úÖ **iOS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–ª–∞–Ω–∞, –∫–∞—Ä—Ç–æ—á–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ, –æ—Ç–º–µ—Ç–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### Backend API

#### –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –ø–ª–∞–Ω
```bash
curl -H "Authorization: Bearer $TOKEN" \
  "http://localhost:8080/v1/workouts/plan?profile_id=$PROFILE_ID"
```

#### –°–æ–∑–¥–∞—Ç—å/–∑–∞–º–µ–Ω–∏—Ç—å –ø–ª–∞–Ω
```bash
curl -X PUT http://localhost:8080/v1/workouts/plan/replace \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "profile_id": "'"$PROFILE_ID"'",
    "title": "–ù–µ–¥–µ–ª—å–Ω—ã–π –ø–ª–∞–Ω",
    "goal": "cardio",
    "replace": true,
    "items": [
      {
        "kind": "run",
        "time_minutes": 420,
        "days_mask": 85,
        "duration_min": 30,
        "intensity": "medium",
        "note": "–£—Ç—Ä–µ–Ω–Ω—è—è –ø—Ä–æ–±–µ–∂–∫–∞"
      }
    ]
  }'
```

#### –û—Ç–º–µ—Ç–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
```bash
curl -X POST http://localhost:8080/v1/workouts/completions \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "profile_id": "'"$PROFILE_ID"'",
    "date": "2024-01-15",
    "plan_item_id": "'"$ITEM_ID"'",
    "status": "done",
    "note": "–û—Ç–ª–∏—á–Ω–∞—è –ø—Ä–æ–±–µ–∂–∫–∞!"
  }'
```

#### –ü–æ–ª—É—á–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
```bash
curl -H "Authorization: Bearer $TOKEN" \
  "http://localhost:8080/v1/workouts/today?profile_id=$PROFILE_ID&date=2024-01-15"
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

**–¢–∏–ø—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ (kind)**:
- `run` ‚Äî –±–µ–≥
- `walk` ‚Äî –ø—Ä–æ–≥—É–ª–∫–∞
- `strength` ‚Äî —Å–∏–ª–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞
- `morning` ‚Äî —É—Ç—Ä–µ–Ω–Ω—è—è –∑–∞—Ä—è–¥–∫–∞
- `core` ‚Äî —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –Ω–∞ –∫–æ—Ä
- `other` ‚Äî –¥—Ä—É–≥–æ–µ

**–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å (intensity)**:
- `low` ‚Äî –Ω–∏–∑–∫–∞—è
- `medium` ‚Äî —Å—Ä–µ–¥–Ω—è—è
- `high` ‚Äî –≤—ã—Å–æ–∫–∞—è

**–¶–µ–ª–∏ –ø–ª–∞–Ω–∞ (goal)**:
- `cardio` ‚Äî –∫–∞—Ä–¥–∏–æ/–≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å
- `strength` ‚Äî —Å–∏–ª–∞
- `flexibility` ‚Äî –≥–∏–±–∫–æ—Å—Ç—å
- `general` ‚Äî –æ–±—â–µ–µ –∑–¥–æ—Ä–æ–≤—å–µ

**–ë–∏—Ç–æ–≤–∞—è –º–∞—Å–∫–∞ –¥–Ω–µ–π (days_mask)**:
- –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ = 1
- –í—Ç–æ—Ä–Ω–∏–∫ = 2
- –°—Ä–µ–¥–∞ = 4
- –ß–µ—Ç–≤–µ—Ä–≥ = 8
- –ü—è—Ç–Ω–∏—Ü–∞ = 16
- –°—É–±–±–æ—Ç–∞ = 32
- –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ = 64
- –ü—Ä–∏–º–µ—Ä: 127 (–≤—Å–µ –¥–Ω–∏), 85 (–ø–Ω+—Å—Ä+–ø—Ç+–≤—Å), 96 (—Å–±+–≤—Å)

### iOS –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. **–ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω** ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∞ —Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –∏ –±—ã—Å—Ç—Ä—ã–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏ –æ—Ç–º–µ—Ç–∫–∏
2. **ActivityView ‚Üí –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏** ‚Äî –ø–æ–ª–Ω—ã–π –ø–ª–∞–Ω —Å —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º
3. **ChatView** ‚Äî AI –º–æ–∂–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø–ª–∞–Ω —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –æ–¥–Ω–∏–º –Ω–∞–∂–∞—Ç–∏–µ–º

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è `workout_reminder`:
- –ó–∞ 30 –º–∏–Ω—É—Ç –¥–æ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- –£—á–∏—Ç—ã–≤–∞–µ—Ç quiet hours –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ—Å–ª–∏ –≤—Å–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç—Å—è max_per_day –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è MVP

- –ú–∞–∫—Å–∏–º—É–º 30 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –ø–ª–∞–Ω–µ
- –ú–∞–∫—Å–∏–º—É–º 4 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤ –æ–¥–∏–Ω –¥–µ–Ω—å
- `details` JSON ‚Äî –º–∞–∫—Å–∏–º—É–º 16KB
- –û–¥–∏–Ω –∞–∫—Ç–∏–≤–Ω—ã–π –ø–ª–∞–Ω –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ workouts –∏–∑ HealthKit ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–ø–æ–∫–∞ —É–ø—Ä–æ—â–µ–Ω–∞)

### –ú–∏–≥—Ä–∞—Ü–∏–∏

```bash
cd server
goose -dir migrations postgres "$DATABASE_URL" up
```

–ú–∏–≥—Ä–∞—Ü–∏—è `00013_workout_plans.sql` —Å–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—ã:
- `workout_plans` ‚Äî –ø–ª–∞–Ω—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
- `workout_plan_items` ‚Äî —ç–ª–µ–º–µ–Ω—Ç—ã –ø–ª–∞–Ω–æ–≤
- `workout_completions` ‚Äî –æ—Ç–º–µ—Ç–∫–∏ –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏

### –¢–µ—Å—Ç—ã

```bash
cd server
go test ./internal/workouts/... -v
go test ./internal/notifications/... -run TestWorkout -v
```

---

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ** (—à–∞–≥ 7 ‚Äî Workout Plans MVP):
- ‚úÖ Storage –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –¥–≤—É–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è–º–∏ (InMemory + Postgres)
- ‚úÖ CRUD API –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–µ–π (`/v1/profiles`)
- ‚úÖ –ë–∞—Ç—á–µ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ (`POST /v1/sync/batch`)
- ‚úÖ API –¥–ª—è —á—Ç–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫ (`GET /v1/metrics/daily`, `GET /v1/metrics/hourly`)
- ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (daily/hourly/sleep/workouts)
- ‚úÖ Unit —Ç–µ—Å—Ç—ã –¥–ª—è metrics handlers (5 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ OpenAPI —Å—Ö–µ–º—ã –¥–ª—è Metrics API
- ‚úÖ iOS networking —Å–ª–æ–π —Å –º–µ—Ç–æ–¥–∞–º–∏ sync/metrics
- ‚úÖ iOS UI –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫ (MetricsView)
- ‚úÖ **HealthKit –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞ iOS** (Steps, Heart Rate, Weight)
- ‚úÖ **HealthKitManager** ‚Äî —á—Ç–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ Health
- ‚úÖ **–ü–æ—á–∞—Å–æ–≤–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è** ‚Äî HKStatisticsCollectionQuery –¥–ª—è hourly buckets
- ‚úÖ **–î–Ω–µ–≤–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è** ‚Äî daily totals (steps, resting HR, last weight)
- ‚úÖ **HealthKit UI** ‚Äî –∑–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π, sync —Å–µ–≥–æ–¥–Ω—è/7 –¥–Ω–µ–π
- ‚úÖ **Checkins API** ‚Äî —É—Ç—Ä–µ–Ω–Ω–∏–µ/–≤–µ—á–µ—Ä–Ω–∏–µ —á–µ–∫–∏–Ω—ã —Å –æ—Ü–µ–Ω–∫–æ–π (1-5), —Ç–µ–≥–∞–º–∏, –∑–∞–º–µ—Ç–∫–∞–º–∏
- ‚úÖ **Checkins storage** ‚Äî UPSERT –ø–æ (profile_id, date, type) –¥–ª—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- ‚úÖ **Feed Day Summary API** ‚Äî –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç daily metrics + checkins –∑–∞ –¥–µ–Ω—å
- ‚úÖ **Missing fields detection** ‚Äî API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ Unit —Ç–µ—Å—Ç—ã –¥–ª—è checkins (5 —Ç–µ—Å—Ç–æ–≤) –∏ feed (5 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ SQL –º–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ goose (`server/migrations/*.sql`)
- ‚úÖ `.env.example` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ **Reports API** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è PDF/CSV –æ—Ç—á—ë—Ç–æ–≤ (`POST /v1/reports`, `GET /v1/reports`, `GET /v1/reports/{id}/download`, `DELETE /v1/reports/{id}`)
- ‚úÖ **iOS —ç–∫—Å–ø–æ—Ä—Ç –æ—Ç—á—ë—Ç–æ–≤** ‚Äî –∫–Ω–æ–ø–∫–∏ "–≠–∫—Å–ø–æ—Ä—Ç PDF/CSV" –≤ MetricsView, Share Sheet –¥–ª—è —Ñ–∞–π–ª–æ–≤
- ‚úÖ **–ò—Å—Ç–æ—Ä–∏—è –æ—Ç—á—ë—Ç–æ–≤** ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –æ—Ç—á—ë—Ç–æ–≤ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Å–∫–∞—á–∞—Ç—å/—É–¥–∞–ª–∏—Ç—å
- ‚úÖ **OpenAPI** ‚Äî –µ–¥–∏–Ω—ã–π `contracts/openapi.yaml` —Å–æ –≤—Å–µ–º–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏ (Profiles, Metrics, Checkins, Feed, Reports, Sources)
- ‚úÖ **Sources API** ‚Äî —Å—Å—ã–ª–∫–∏, –∑–∞–º–µ—Ç–∫–∏, —Ñ–æ—Ç–æ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∫ profile/checkin
- ‚úÖ **Sources storage** ‚Äî memory + postgres —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, S3 –¥–ª—è —Ñ–æ—Ç–æ
- ‚úÖ **iOS Sources models + APIClient** ‚Äî –º–æ–¥–µ–ª–∏ –∏ –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å sources
- ‚úÖ **iOS ActivityView (Sources screen)** ‚Äî —Å–ø–∏—Å–æ–∫, –ø–æ–∏—Å–∫, —Ñ–∏–ª—å—Ç—Ä—ã, —Å–æ–∑–¥–∞–Ω–∏–µ link/note
- ‚úÖ **iOS FeedView attachments UI** ‚Äî —Ñ–æ—Ç–æ + —Å—Å—ã–ª–∫–∏ + –∑–∞–º–µ—Ç–∫–∏ –≤ checkin editor
- ‚úÖ **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è HealthKit** ‚Äî Sleep (stages), Workouts, Nutrition, Activity details, Wrist Temperature
- ‚úÖ **Inbox/Notifications** ‚Äî server-side —Å–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º
- ‚úÖ **iOS Inbox UI** ‚Äî –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫ —Å –±–µ–π–¥–∂–µ–º –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö, —Å–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ **Smart Local Reminders** ‚Äî iOS –ª–æ–∫–∞–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å server inbox
- ‚úÖ **Background Sync** ‚Äî HealthKit background delivery + observer queries + BGAppRefreshTask
- ‚úÖ **Intakes (Water & Supplements)** ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–∏—ë–º–∞ –≤–æ–¥—ã –∏ –¥–æ–±–∞–≤–æ–∫/–≤–∏—Ç–∞–º–∏–Ω–æ–≤
- ‚úÖ **iOS Intakes UI** ‚Äî —Å–µ–∫—Ü–∏—è "–ü—Ä–∏–µ–º" –≤ ActivityView —Å –≤–æ–¥–æ–π –∏ –¥–æ–±–∞–≤–∫–∞–º–∏
- ‚úÖ **HealthKit write-back** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å –≤–æ–¥—ã –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–æ–±–∞–≤–æ–∫ –≤ Apple Health
- ‚úÖ **Workout Plans API** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–æ–≤ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏
- ‚úÖ **Workout completions** ‚Äî –æ—Ç–º–µ—Ç–∫–∏ –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ (done/skipped)
- ‚úÖ **Workout notifications** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π —Å —É—á–µ—Ç–æ–º quiet hours
- ‚úÖ **iOS Workout Plans UI** ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–ª–∞–Ω–∞, —Ä–µ–¥–∞–∫—Ç–æ—Ä, –∫–∞—Ä—Ç–æ—á–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ
- ‚úÖ **AI Workout Proposals** ‚Äî –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –º–æ–∂–µ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –ø–ª–∞–Ω—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ —á–µ—Ä–µ–∑ —á–∞—Ç
- ‚úÖ **Chat workout_plan apply** ‚Äî –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ –æ–¥–Ω–∏–º –Ω–∞–∂–∞—Ç–∏–µ–º

**–ß—Ç–æ –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ** (–Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –æ—Å—Ç–∞–≤–ª–µ–Ω–æ –Ω–∞ –ø–æ—Ç–æ–º):
- ‚ùå –ê–≤—Ç–æ–ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–ª—è kinds `nutrition_plan` –∏ `generic` (–ø–æ–∫–∞ `unsupported_kind`)
- ‚ùå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö workouts –∏–∑ HealthKit –≤ today endpoint (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —É–ø—Ä–æ—â–µ–Ω–∞)
- ‚úÖ **Deployment scaffold** ‚Äî Dockerfile, render.yaml, docs/DEPLOYMENT.md (Render + Neon + Yandex S3)
- ‚úÖ **Makefile** ‚Äî `make test`, `make run`, `make smoke`, `make migrate-up`, `make build`

---

**–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞**: –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ (–Ω–µ –∫–æ–º–º–∏—Ç—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).

## Meal Plan MVP

### Endpoints

#### Food Preferences

```bash
# List food prefs
curl -H "Authorization: Bearer $TOKEN" \
  "http://localhost:8080/v1/food/prefs?profile_id=$PROFILE_ID&limit=50"

# Create food pref
curl -X POST -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"profile_id":"'$PROFILE_ID'","name":"–û–≤—Å—è–Ω–∫–∞","tags":["–∑–∞–≤—Ç—Ä–∞–∫"],"kcal_per_100g":68,"protein_g_per_100g":12,"fat_g_per_100g":6,"carbs_g_per_100g":12}' \
  http://localhost:8080/v1/food/prefs

# Delete food pref
curl -X DELETE -H "Authorization: Bearer $TOKEN" \
  "http://localhost:8080/v1/food/prefs/$PREF_ID"
```

#### Meal Plans

```bash
# Get active meal plan
curl -H "Authorization: Bearer $TOKEN" \
  "http://localhost:8080/v1/meal/plan?profile_id=$PROFILE_ID"

# Replace meal plan
curl -X PUT -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "profile_id":"'$PROFILE_ID'",
    "title":"–ü–ª–∞–Ω –Ω–∞ –Ω–µ–¥–µ–ª—é",
    "items":[
      {"day_index":0,"meal_slot":"breakfast","title":"–û–≤—Å—è–Ω–∫–∞ —Å –±–∞–Ω–∞–Ω–æ–º","notes":"","approx_kcal":450,"approx_protein_g":15,"approx_fat_g":12,"approx_carbs_g":70},
      {"day_index":0,"meal_slot":"lunch","title":"–ö—É—Ä–∏—Ü–∞ —Å –≥—Ä–µ—á–∫–æ–π","notes":"","approx_kcal":600,"approx_protein_g":45,"approx_fat_g":15,"approx_carbs_g":55}
    ]
  }' \
  http://localhost:8080/v1/meal/plan/replace

# Get today's meals
curl -H "Authorization: Bearer $TOKEN" \
  "http://localhost:8080/v1/meal/today?profile_id=$PROFILE_ID&date=2024-01-15"

# Delete meal plan
curl -X DELETE -H "Authorization: Bearer $TOKEN" \
  "http://localhost:8080/v1/meal/plan?profile_id=$PROFILE_ID"
```

#### Feed/Day (updated)

```bash
# Get day summary (now includes meal_today, meal_plan_title, food_prefs_count)
curl -H "Authorization: Bearer $TOKEN" \
  "http://localhost:8080/v1/feed/day?profile_id=$PROFILE_ID&date=2024-01-15"
```

### AI Generation

Use chat to generate meal plan:

```bash
curl -X POST -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "profile_id":"'$PROFILE_ID'",
    "message":"–°–æ—Å—Ç–∞–≤—å –ø–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è –Ω–∞ –Ω–µ–¥–µ–ª—é"
  }' \
  http://localhost:8080/v1/chat/messages
```

AI will return a proposal with `kind: "meal_plan"`. Apply it:

```bash
curl -X POST -H "Authorization: Bearer $TOKEN" \
  "http://localhost:8080/v1/ai/proposals/$PROPOSAL_ID/apply"
```
